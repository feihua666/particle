import{p as A,a as Q,r as T,d as _,b as M,c as C,e as R,f as B}from"./dataQueryDatasourceApiManage-DUUysU_G.js";import{d as S,r as b,a as k,b as i,o as w,c as F,e as n,w as u,f as N,F as V}from"./index-_8rL1G8m.js";import"./dataQueryDatasourceAdminApi-BUk5qnX0.js";import"./dataqueryProviderCompItem-CXdVZONI.js";import"./dataQueryProviderAdminApi-CC8a5fD0.js";const E=S({__name:"DataQueryDatasourceApiManagePage",props:{name:{type:String}},setup(h){const c=b(null),s=k({form:{name:h.name},formComps:A,tableColumns:[{prop:"code",label:"编码"},{prop:"name",label:"名称"},{prop:"categoryDictName",label:"分类"},{prop:"dataQueryProviderName",label:"数据查询供应商"},{prop:"dataQueryProviderDocLinkUrl",label:"文档链接",showOverflowTooltip:!0},{prop:"dataQueryDatasourceName",label:"数据查询数据源"},{prop:"readTimeout",label:"读取等待时间(ms)"},{prop:"connectTimeout",label:"连接等待时间(ms)"},{prop:"sameTag",label:"等同标签"},{prop:"isSupportTrans",label:"翻译支持",formatter:(e,o,a,r)=>a?"支持":"不支持"},{prop:"isPublished",label:"是否发布",formatter:(e,o,a,r)=>a?"已发布":"未发布"},{prop:"isMaster",label:"配置分支",formatter:(e,o,a,r)=>a?"master":"dev"},{prop:"isTestPassed",label:"是否测试通过",formatter:(e,o,a,r)=>a?"测试通过":"未测试通过"},{prop:"remark",label:"描述"}]}),p=b({buttonText:"查询",loading:!1,permission:"admin:web:dataQueryDatasourceApi:pageQuery"}),d=()=>{c.value.refreshData()},f=({pageQuery:e})=>Q({...s.form,...e}),x={permission:p.value.permission},v=({row:e,column:o,$index:a})=>{if(a<0)return[];let r={id:e.id},m=[{txt:"接口测试",text:!0,permission:"admin:web:dataQueryDatasourceApi:test",route:{path:"/admin/DataQueryDatasourceApiManageTest",query:r}},{txt:"编辑",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"已发布不能编辑，可以通过复制dev来修改提交":void 0,permission:"admin:web:dataQueryDatasourceApi:update",position:"more",route:{path:"/admin/DataQueryDatasourceApiManageUpdate",query:r}},{txt:"删除",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"已发布不能删除":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:delete",methodConfirmText:`可能存在数据查询引用（包括直连引用或通过编码脚本调用）请确保安全，确定要删除 ${e.name} 吗？`,method(){return T({id:e.id}).then(t=>(d(),Promise.resolve(t)))}},{txt:"删除缓存",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:deleteCache",methodConfirmText:`确定要删除 ${e.name} 缓存吗？如果部署多个实例可能要多次执行`,methodSuccess:t=>"删除缓存成功 "+t.data.data,method(){return _({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"刷新缓存",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:refreshCache",methodSuccess:t=>"刷新缓存成功，如果部署多个实例可能要多次执行。 "+t.data.data,method(){return M({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"复制",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"仅支持master复制",position:"more",permission:"admin:web:dataQueryDatasourceApi:copy",methodConfirmText:`确定要复制 ${e.name} 吗？`,methodSuccess:t=>{s.form.name=t.data.data.name,d()},method(){return C({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"复制dev",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"仅支持master复制",position:"more",permission:"admin:web:dataQueryDatasourceApi:copydev",methodConfirmText:`确定要复制 ${e.name} 吗？复制后可以修改并提交到主分支`,methodSuccess:t=>{s.form.name=t.data.data.name,d()},method(){return R({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"查看",text:!0,permission:"admin:web:dataQueryDatasourceApi:detail",position:"more",route:{path:"/admin/DataQueryDatasourceApiManageView",query:r}}];return e.isMaster||m.push({txt:"提交至master",text:!0,disabled:e.isMaster,disabledReason:e.isMaster?"仅支持dev":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:devMergeToMaster",methodConfirmText:`确定要将 ${e.name} 提交至master吗？提交成功后本数据将会被删除！`,methodSuccess:t=>{d()},method(){return B({id:e.id}).then(t=>Promise.resolve(t))}}),m};return(e,o)=>{const a=i("PtButton"),r=i("PtForm"),m=i("PtButtonGroup"),t=i("el-table-column"),y=i("PtTable"),D=i("PtRouteViewPopover");return w(),F(V,null,[n(r,{form:s.form,method:d,defaultButtonsShow:"submit,reset",submitAttrs:p.value,labelWidth:"120",inline:"",comps:s.formComps},{buttons:u(()=>[n(a,{permission:"admin:web:dataQueryDatasourceApi:create",route:"/admin/DataQueryDatasourceApiManageAdd"},{default:u(()=>o[1]||(o[1]=[N("添加")])),_:1})]),_:1},8,["form","submitAttrs","comps"]),n(y,{ref_key:"tableRef",ref:c,"default-expand-all":"",dataMethod:f,onDataMethodDataLoading:o[0]||(o[0]=l=>p.value.loading=l),paginationProps:x,columns:s.tableColumns},{defaultAppend:u(()=>[n(t,{label:"操作",width:"220"},{default:u(({row:l,column:P,$index:g})=>[n(m,{options:v({row:l,column:P,$index:g}),dropdownTriggerButtonOptions:{text:!0,buttonText:"更多"}},null,8,["options"])]),_:1})]),_:1},8,["columns"]),n(D,{level:3})],64)}}});export{E as default};
