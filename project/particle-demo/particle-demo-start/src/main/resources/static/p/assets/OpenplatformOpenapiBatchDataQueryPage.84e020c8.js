import{d as R,r as c,a as S,b as l,o as A,c as g,e as n,f as o,w as E,g as q,F as M,X as G,b1 as W,b2 as K,b3 as x,b4 as L,_ as X}from"./index.ddde0bc1.js";import{b as j,e as z,f as H}from"./openplatformOpenapiCompItem.2eaf5494.js";import{a as J}from"./openplatformAppCompItem.11990ff8.js";import{e as w,a as Y,d as O}from"./FileTools.94b84ff7.js";import{t as Z,d as $}from"./openplatformOpenapiBatchQueryRecordAdminApi.65514441.js";import"./openplatformAppAdminApi.05007165.js";import"./crmCompItem.4ff56a2e.js";import"./crmCustomerTagAdminApi.e29d31d0.js";const ee={key:0},te=R({name:"OpenplatformOpenapiBatchDataQueryPage"}),ue=R({...te,setup(ae){let C=(e,t="success")=>{G({showClose:!0,message:e,type:t,showIcon:!0,grouping:!0})};const B=c(null),p=c(null),u=S({form:{},formComps:[J({label:"\u5E94\u7528",required:!0,valueChange:({form:e,newValue:t})=>{t||(e.openplatformOpenapiId=null)},tips:" 1. \u8BF7\u5148\u9009\u62E9\u8981\u4F7F\u7528\u7684\u5E94\u7528"}),j({fieldName:"openplatformOpenapiId",label:"\u5F00\u653E\u63A5\u53E3",required:!0,disableGroup:!0,valueChange:({form:e,newValue:t})=>{},tips:" 2. \u8BF7\u9009\u62E9\u8981\u67E5\u8BE2\u7684\u63A5\u53E3"})],templateform:{},templateformComps:[{field:{name:"file",value:[]},element:{comp:"PtUpload",formItemProps:{label:"\u67E5\u8BE2\u6587\u4EF6",required:!0,displayBlock:!0},compProps:{drag:!0,autoUpload:!1,limit:1,dragTip:"\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\u6216<em>\u70B9\u51FB\u4E0A\u4F20</em>",tipTxt:"\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF0C\u8BF7\u4E25\u683C\u6309\u7167\u4E0B\u8F7D\u7684\u6A21\u677F\u8FDB\u884C\u586B\u5199\uFF0C\u5E76\u4FDD\u8BC1\u7B2C\u4E00\u4E2Asheet\u4E3A\u67E5\u8BE2\u53C2\u6570",onExceed:(e,t)=>{C("\u6700\u591A\u53EA\u80FD\u9009\u62E9\u4E00\u4E2A\u6587\u4EF6,\u5982\u8981\u91CD\u65B0\u9009\u62E9\uFF0C\u8BF7\u5148\u5220\u9664\u4E4B\u524D\u7684\u6587\u4EF6","error")}}}},{field:{name:"remark"},element:{comp:"el-input",formItemProps:{label:"\u5907\u6CE8",required:!0,displayBlock:!0},compProps:{clearable:!0}}}],openplatformOpenapiBatchQueryRecordId:null,tableColumns:Z,tableData:[]}),f=c({buttonText:"\u67E5\u8BE2",loading:!1,permission:"admin:web:openplatformOpenapi:batchQuery"}),P=()=>{y(()=>{_(()=>{f.value.loading=!0,Q().then(e=>{let t=e.data.data;u.openplatformOpenapiBatchQueryRecordId=t.id,k(u.openplatformOpenapiBatchQueryRecordId),C("\u67E5\u8BE2\u6210\u529F,\u60A8\u53EF\u5728\u5F53\u524D\u9875\u9762\u5237\u65B0\u7ED3\u679C\u72B6\u6001\u6216\u7A0D\u5019\u524D\u5F80\u6279\u91CF\u67E5\u8BE2\u8BB0\u5F55\u67E5\u770B\u7ED3\u679C")}).finally(()=>{f.value.loading=!1})})}),_(()=>{})},y=e=>{B.value&&B.value.formRef.validate((t,a)=>{t&&e()})},_=e=>{p.value&&p.value.formRef.validate((t,a)=>{t&&e()})},Q=()=>{let e=new FormData;for(let t in u.form)e.append(t,u.form[t]);return e.append("file",u.templateform.file[0].raw),e.append("remark",u.templateform.remark),H(e)},I=()=>{p.value&&p.value.resetForm()},F=c(!1),T=()=>{y(()=>{F.value=!0;let e={};for(let t in u.form)e[t]=u.form[t];z(e).then(t=>{let a=t.data,m=w(t),r=Y(t);r=decodeURIComponent(r),O(a,m,r)}).finally(()=>{F.value=!1})})},k=e=>{x(u.tableData),v(e).then(t=>{u.tableData=[t.data.data]})},U=e=>v(e).then(t=>{for(let a=0;a<u.tableData.length;a++)u.tableData[a].id==e&&L(u.tableData,a,t.data.data);return Promise.resolve(t)}),v=e=>$({id:e}),N=({row:e,column:t,$index:a})=>{if(a<0)return[];e.id;let m={openplatformOpenapiBatchQueryRecordId:e.id};return[{txt:"\u5237\u65B0",text:!0,method(){return U(u.openplatformOpenapiBatchQueryRecordId)}},{txt:"\u4E0B\u8F7D",text:!0,disabled:e.executeStatusDictValue!="finished",disabledReason:e.executeStatusDictValue!="finished"?"\u6267\u884C\u5B8C\u6210\u540E\u624D\u53EF\u80FD\u4E0B\u8F7D":void 0,method(){let i=W(e.exportFileUrl),b=i.substring(i.lastIndexOf("/")+1);return K(i).then(s=>{let h=s.data,d=w(s),D=decodeURIComponent(b);return O(h,d,D),Promise.resolve(s)})}},{txt:"\u67E5\u770B\u8BE6\u60C5",text:!0,position:"more",permission:"admin:web:openplatformOpenapiBatchQueryRecordDetail:pageQuery",route:{path:"/admin/openplatformOpenapiBatchQueryRecordDetail1",query:m}},{txt:"\u5220\u9664",text:!0,position:"more",methodConfirmText:"\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u6570\u636E\u5417\uFF1F\u5220\u9664\u540E\u60A8\u53EF\u4EE5\u524D\u5F80\u6279\u91CF\u67E5\u8BE2\u8BB0\u5F55\u67E5\u770B\u7ED3\u679C",method(){u.openplatformOpenapiBatchQueryRecordId=null,x(u.tableData)}}]};return(e,t)=>{const a=l("PtForm"),m=l("PtButton"),r=l("PtButtonGroup"),i=l("el-table-column"),b=l("PtTable"),s=l("el-alert"),h=l("PtRouteViewPopover");return A(),g(M,null,[n(" \u67E5\u8BE2\u8868\u5355 "),o(a,{ref_key:"formRef",ref:B,form:u.form,labelWidth:"120",defaultButtonsShow:"",inline:"",layout:2,comps:u.formComps},null,8,["form","comps"]),n(" \u6A21\u677F\u4E0A\u4F20\u67E5\u8BE2\u8868\u5355 "),o(a,{ref_key:"templateFormRef",ref:p,form:u.templateform,labelWidth:"120",defaultButtonsShow:"",inline:"",layout:1,comps:u.templateformComps},null,8,["form","comps"]),n(" \u6309\u94AE\u8868\u5355 "),o(a,{form:[],labelWidth:"120",method:P,defaultButtonsShow:"submit,reset",submitAttrs:f.value,inline:"",showButtonItem:!0,onResetForm:I,comps:[]},{buttons:E(()=>[o(m,{permission:"admin:web:openplatformOpenapi:batchQuery",loading:F.value,method:T},{default:E(()=>[q("\u4E0B\u8F7D\u6A21\u677F")]),_:1},8,["loading"])]),_:1},8,["submitAttrs"]),u.openplatformOpenapiBatchQueryRecordId?(A(),g("div",ee,[n(" \u67E5\u8BE2\u540E\u7684\u7ED3\u679C\uFF0C\u53EF\u4EE5\u8FDB\u884C\u72B6\u6001\u67E5\u770B "),o(b,{ref:"tableRef","default-expand-all":"",data:u.tableData,onDataMethodDataLoading:t[0]||(t[0]=d=>f.value.loading=d),columns:u.tableColumns},{defaultAppend:E(()=>[o(i,{label:"\u64CD\u4F5C",width:"220"},{default:E(({row:d,column:D,$index:V})=>[o(r,{options:N({row:d,column:D,$index:V}),dropdownTriggerButtonOptions:{text:!0,buttonText:"\u66F4\u591A"}},null,8,["options"])]),_:1})]),_:1},8,["data","columns"]),o(s,{title:"\u6CE8\u610F\uFF1A\u4EE5\u4E0A\u8868\u683C\u4EC5\u5C55\u793A\u6700\u540E\u4E00\u6B21\u67E5\u8BE2\u7684\u67E5\u8BE2\u7ED3\u679C",type:"info",style:{width:"350px","margin-top":"10px"}})])):n("v-if",!0),n(" \u5B50\u7EA7\u8DEF\u7531 "),o(h,{level:3})],64)}}}),de=X(ue,[["__file","/Users/yw/fh/git-source/particle/web/component/pc/openplatform/views/openapi/admin/OpenplatformOpenapiBatchDataQueryPage.vue"]]);export{de as default};
