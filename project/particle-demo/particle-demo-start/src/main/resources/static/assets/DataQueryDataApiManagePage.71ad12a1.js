import{p as v,r as P,d as g,a as _,c as Q,b as T,e as M}from"./dataQueryDataApiAdminApi.fa0fd6f5.js";import{p as R}from"./dataQueryDataApiManage.88fba344.js";import{d as c,r as D,a as N,b as s,o as S,c as V,e as i,w as m,f as $,F as k}from"./index.11decc6c.js";import"./dataQueryDatasourceApiManage.c1d4402a.js";import"./dataQueryDatasourceAdminApi.734b8d3c.js";import"./dataqueryProviderCompItem.713be509.js";import"./dataQueryProviderAdminApi.c6ad7683.js";const q=c({name:"DataQueryDataApiManagePage"}),j=c({...q,props:{url:{type:String}},setup(A){const b=A,F=D(null),o=N({form:{url:b.url||null},formComps:R,tableColumns:[{prop:"url",label:"\u63A5\u53E3\u5730\u5740"},{prop:"name",label:"\u63A5\u53E3\u540D\u79F0"},{prop:"dataQueryDatasourceApiName",label:"\u76F4\u8FDE\u6570\u636E\u6E90\u63A5\u53E3"},{prop:"adaptTypeDictName",label:"\u9002\u914D\u7C7B\u578B"},{prop:"inParamTypeDictName",label:"\u5165\u53C2\u7C7B\u578B"},{prop:"outParamTypeDictName",label:"\u51FA\u53C2\u7C7B\u578B"},{prop:"responseTypeDictName",label:"\u8F93\u51FA\u7C7B\u578B"},{prop:"isPublished",label:"\u662F\u5426\u53D1\u5E03",formatter:(e,r,t,a)=>t?"\u5DF2\u53D1\u5E03":"\u672A\u53D1\u5E03"},{prop:"isMaster",label:"\u914D\u7F6E\u5206\u652F",formatter:(e,r,t,a)=>t?"master":"dev"},{prop:"isTestPassed",label:"\u662F\u5426\u6D4B\u8BD5\u901A\u8FC7",formatter:(e,r,t,a)=>t?"\u6D4B\u8BD5\u901A\u8FC7":"\u672A\u6D4B\u8BD5\u901A\u8FC7"},{prop:"remark",label:"\u63CF\u8FF0"}]}),p=D({buttonText:"\u67E5\u8BE2",loading:!1,permission:"admin:web:dataQueryDataApi:pageQuery"}),n=()=>{F.value.refreshData()},E=({pageQuery:e})=>v({...o.form,...e}),B={permission:p.value.permission},h=({row:e,column:r,$index:t})=>{if(t<0)return[];let a={id:e.id},d=[{txt:"\u63A5\u53E3\u6D4B\u8BD5",text:!0,permission:"admin:web:dataQueryDataApi:test",route:{path:"/admin/DataQueryDataApiManageTest",query:a}},{txt:"\u7F16\u8F91",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"\u5DF2\u53D1\u5E03\u4E0D\u80FD\u7F16\u8F91\uFF0C\u53EF\u4EE5\u901A\u8FC7\u590D\u5236dev\u6765\u4FEE\u6539\u63D0\u4EA4":void 0,position:"more",permission:"admin:web:dataQueryDataApi:update",route:{path:"/admin/DataQueryDataApiManageUpdate",query:a}},{txt:"\u5220\u9664",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"\u5DF2\u53D1\u5E03\u4E0D\u80FD\u5220\u9664":void 0,position:"more",permission:"admin:web:dataQueryDataApi:delete",methodConfirmText:`\u786E\u5B9A\u8981\u5220\u9664 ${e.name} \u5417\uFF1F`,method(){return P({id:e.id}).then(u=>(n(),Promise.resolve(u)))}},{txt:"\u5220\u9664\u7F13\u5B58",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:deleteCache",methodConfirmText:`\u786E\u5B9A\u8981\u5220\u9664 ${e.name} \u7F13\u5B58\u5417\uFF1F\u5982\u679C\u90E8\u7F72\u591A\u4E2A\u5B9E\u4F8B\u53EF\u80FD\u8981\u591A\u6B21\u6267\u884C`,methodSuccess:u=>"\u5220\u9664\u7F13\u5B58\u6210\u529F "+u.data.data,method(){return g({id:e.id}).then(u=>Promise.resolve(u))}},{txt:"\u5237\u65B0\u7F13\u5B58",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:refreshCache",methodSuccess:u=>"\u5237\u65B0\u7F13\u5B58\u6210\u529F,\u5982\u679C\u90E8\u7F72\u591A\u4E2A\u5B9E\u4F8B\u53EF\u80FD\u8981\u591A\u6B21\u6267\u884C\u3002 "+u.data.data,method(){return _({id:e.id}).then(u=>Promise.resolve(u))}},{txt:"\u590D\u5236",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"\u4EC5\u652F\u6301master\u590D\u5236",position:"more",permission:"admin:web:dataQueryDataApi:copy",methodConfirmText:`\u786E\u5B9A\u8981\u590D\u5236 ${e.name} \u5417\uFF1F`,methodSuccess:u=>{o.form.name=u.data.data.name,n()},method(){return Q({id:e.id}).then(u=>Promise.resolve(u))}},{txt:"\u590D\u5236dev",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"\u4EC5\u652F\u6301master\u590D\u5236",position:"more",permission:"admin:web:dataQueryDataApi:copydev",methodConfirmText:`\u786E\u5B9A\u8981\u590D\u5236 ${e.name} \u5417\uFF1F\u590D\u5236\u540E\u53EF\u4EE5\u4FEE\u6539\u5E76\u63D0\u4EA4\u5230\u4E3B\u5206\u652F`,methodSuccess:u=>{o.form.name=u.data.data.name,n()},method(){return T({id:e.id}).then(u=>Promise.resolve(u))}},{txt:"\u67E5\u770B",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:view",route:{path:"/admin/DataQueryDataApiManageView",query:a}}];return e.isMaster||d.push({txt:"\u63D0\u4EA4\u81F3master",text:!0,disabled:e.isMaster,disabledReason:e.isMaster?"\u4EC5\u652F\u6301dev":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:devMergeToMaster",methodConfirmText:`\u786E\u5B9A\u8981\u5C06 ${e.name} \u63D0\u4EA4\u81F3master\u5417\uFF1F\u63D0\u4EA4\u6210\u529F\u540E\u672C\u6570\u636E\u5C06\u4F1A\u88AB\u5220\u9664\uFF01`,methodSuccess:u=>{n()},method(){return M({id:e.id}).then(u=>Promise.resolve(u))}}),e.adaptTypeDictValue=="single_direct"&&d.push({txt:"\u67E5\u770B\u6570\u636E\u6E90\u63A5\u53E3",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:pageQuery",route:{path:"/admin/dataQueryDatasourceApiManagePage",query:{dataQueryDatasourceApiName:e.dataQueryDatasourceApiName}}}),d};return(e,r)=>{const t=s("PtButton"),a=s("PtForm"),d=s("PtButtonGroup"),u=s("el-table-column"),f=s("PtTable"),C=s("PtRouteViewPopover");return S(),V(k,null,[i(a,{form:o.form,method:n,defaultButtonsShow:"submit,reset",submitAttrs:p.value,inline:"",comps:o.formComps},{buttons:m(()=>[i(t,{permission:"admin:web:dataQueryDataApi:create",route:"/admin/DataQueryDataApiManageAdd"},{default:m(()=>[$("\u6DFB\u52A0")]),_:1})]),_:1},8,["form","submitAttrs","comps"]),i(f,{ref_key:"tableRef",ref:F,"default-expand-all":"",dataMethod:E,onDataMethodDataLoading:r[0]||(r[0]=l=>p.value.loading=l),dataMethodResultHandleConvertToTree:!0,paginationProps:B,columns:o.tableColumns},{defaultAppend:m(()=>[i(u,{label:"\u64CD\u4F5C",width:"180"},{default:m(({row:l,column:y,$index:x})=>[i(d,{options:h({row:l,column:y,$index:x}),dropdownTriggerButtonOptions:{text:!0,buttonText:"\u66F4\u591A"}},null,8,["options"])]),_:1})]),_:1},8,["columns"]),i(C,{level:3})],64)}}});export{j as default};
