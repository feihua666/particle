import{u as k,H as T,i as $,a as z,b as I,c as L,d as K,e as H}from"./index.esm.min.b2cf49be.js";import{l as U}from"./ssqCodeOpenedAdminApi.25a947da.js";import{d as B,r as d,a as G,ad as J,b as Q,o as F,c as v,e as y,U as g,W as P,F as x,T as X,u as Z,i as ee}from"./index.48f373ed.js";const te={key:0},ue={key:1},oe=B({name:"SsqCodeOpenedSeqNoTrendPage.vue"}),re=B({...oe,setup(le){k([$,z,I,L,K,H]);const A=d(),c=G({form:{},formComps:[{field:{name:"openedPhaseYearStart",value:"2013"},element:{comp:"PtDatePicker",formItemProps:{label:"\u5F00\u5956\u671F\u53F7\u5E74\u4EFD\u5F00\u59CB",tips:"\u5305\u62EC\u6570\u503C\u672C\u8EAB"},compProps:{type:"year",valueFormat:"YYYY"}}},{field:{name:"openedPhaseYearEnd"},element:{comp:"PtDatePicker",formItemProps:{label:"\u5F00\u5956\u671F\u53F7\u5E74\u4EFD\u7ED3\u675F",tips:"\u4E0D\u5305\u62EC\u6570\u503C\u672C\u8EAB"},compProps:{type:"year",valueFormat:"YYYY"}}},{field:{name:"slidingWindowSize",value:5},element:{comp:"el-input-number",formItemProps:{label:"\u6ED1\u52A8\u7A97\u53E3\u5927\u5C0F",tips:"\u53EF\u8C03\u7528\u6ED1\u52A8\u7A97\u53E3\u5927\u5C0F\u4EE5\u5BFB\u627E\u6700\u4F73\u6ED1\u52A8\u7A97\u53E3\u5927\u5C0F"},compProps:{}}},{field:{name:"computeObject",value:"seqNo"},element:{comp:"PtSelect",formItemProps:{label:"\u8BA1\u7B97\u5BF9\u8C61",required:!0},compProps:{dataMethod:()=>({data:[{id:"seqNo",name:"\u5E8F\u53F7"},{id:"redSeqNo",name:"\u7EA2\u5E8F\u53F7"},{id:"blue",name:"\u84DD\u7403"}]})}}}]}),D=d({buttonText:"\u8BA1\u7B97",loading:!1,permission:"admin:web:ssqCodeOpened:queryList"}),h=d({}),C=d([]),m=d({}),N=()=>U(c.form).then(t=>{let u=t.data.data;m.value=_[c.form.computeObject];let o=E(u,c.form.slidingWindowSize,m.value.fieldName,m.value.max,m.value.valueFormat,!0);A.value=o;let a=[];for(let e=0;e<o.length;e++)a=a.concat(o[e].myCustom.maxOffset);return C.value=Y(a),q(u,m.value.fieldName,m.value.max,m.value.valueFormat),Promise.resolve(t)});J(()=>{let t=S([7,13,8,6,3,3,7,3,6,2,11,2,15,15,3],[8.8,8.2,8.9,8.1,9.1,9.3,9.6]);console.log(t)});const S=(t,u)=>{let o=[];for(let a=1;a<17;a++){let n=t.concat([a]).reduce((s,r)=>s+r)/16;n=n.toFixed(1),u.some((s,r)=>n>=7.5&&n<=9.5)&&o.push(a)}return o},_={seqNo:{max:17721008,fieldName:"seqNo",valueFormat:t=>t.toFixed(5)},redSeqNo:{max:1107568,fieldName:"redSeqNo",valueFormat:t=>t.toFixed(5)},blue:{max:16,fieldName:"blue",valueFormat:t=>t.toFixed(5)}},q=(t,u,o,a)=>{let e=null,l=null,n=null;for(let s=4;s<=c.form.slidingWindowSize;s++){let r=E(t,s,u,o,a,!1);if(!!r)for(let f=0;f<r.length;f++){let i=r[f],p=w(i.series[0].data);e==null?e=p:e>p&&(e=p,l=s,n=i.myCustom.offsetDelta)}}h.value={minWindowSize:l,offsetDelta:n}},E=(t,u,o,a,e,l)=>{let n=[];for(let s=0;s<u;s++){let r=O(t,s,u,o,a,e,l);n=n.concat(r)}return n},O=(t,u,o,a,e,l,n)=>{let s=[],r=[],f=[];for(let i=u;i<t.length;i++){if(i+o-1>=t.length)continue;let p=0;for(let b=0;b<o;b++)p+=t[i+b][a];s.push(t[i+o-1].openedPhase);let V=p/o,W=(e+1)/2,j=V-W;r.push(Number(l(j)))}return s.length>0&&f.push(R(s,r,"\u504F\u79FB\uFF1A"+u,u,n)),f};function w(t){const u=t.length,o=t.reduce((l,n)=>l+n)/u;return t.map(l=>Math.pow(l-o,2)).reduce((l,n)=>l+n)/u}const Y=t=>{let u={};for(let e=0;e<t.length;e++){let l=u[t[e].offset];l==null?u[t[e].offset]=0:t[e].count>l&&(u[t[e].offset]=t[e].count)}let o=[];for(let e in u)o.push({offset:e,count:u[e]});return o.sort((e,l)=>l.count-e.count),o.slice(0,10)},M=t=>{let u={};for(let e=0;e<t.length;e++){let l=u[t[e]+""];l==null?u[t[e]+""]=0:u[t[e]+""]=l+1}let o=[];for(let e in u)o.push({offset:e,count:u[e]});return o.sort((e,l)=>l.count-e.count),o.slice(0,10)},R=(t,u,o,a,e)=>({myCustom:{offsetDelta:a,maxOffset:e?M(u):[]},title:{text:o},grid:{left:"0",right:"0",bottom:"0",containLabel:!0},tooltip:{trigger:"axis",show:!0,formatter:"\u5E8F\u53F7\uFF1A{c}<br/>\u671F\u53F7\uFF1A{b}"},xAxis:{type:"category",data:t,axisLabel:{rotate:30}},yAxis:{type:"value"},series:[{data:u,type:"bar",label:{show:!0,position:"top",formatter:"{c}"}}]});return(t,u)=>{const o=Q("PtForm");return F(),v(x,null,[y(o,{form:c.form,method:N,defaultButtonsShow:"submit,reset",submitAttrs:D.value,inline:"",comps:c.formComps},null,8,["form","submitAttrs","comps"]),h.value.minWindowSize?(F(),v("div",te," \u6700\u4F73\u6ED1\u52A8\u7A97\u53E3\u5927\u5C0F\uFF1A"+g(h.value.minWindowSize)+" \u504F\u79FB\uFF1A"+g(h.value.offsetDelta),1)):P("",!0),C.value.length>0?(F(),v("div",ue," \u6700\u4F73\u504F\u79FB\u91CFtop10\uFF1A"+g(C.value),1)):P("",!0),(F(!0),v(x,null,X(A.value,(a,e)=>(F(),v(x,null,[y(Z(T),{style:{width:"1000%",height:"300px"},option:a,autoresize:""},null,8,["option"]),ee("div",null,g(a.myCustom.maxOffset),1)],64))),256))],64)}}});export{re as default};
