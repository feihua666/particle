import{l as I}from"./dataQueryDatasourceApiManage.59dfc43d.js";import{d as C,r as g,a as S,ao as y,ad as J,b as d,o as E,c as B,e as s,w as m,F as D,h as P,i as v,f as V,T as w}from"./index.661e0f85.js";const M=C({name:"AdaptMultipleAggregationConfig"}),x=C({...M,props:{initJsonStr:{type:String}},setup(l,{expose:A}){const u=l,n=g(null),t=S({initJson:{aggregationItems:[]},form:{datasourceApiName:""},formComps:[{field:{name:"outputKey"},element:{comp:"el-input",formItemProps:{label:"\u805A\u5408\u53D8\u91CF",required:!0,tips:"\u5C06\u4EE5\u8BE5\u53D8\u91CF\u505A\u4E3A\u8F93\u51FA\u5BF9\u8C61\u7684key"},compProps:{clearable:!0}}},{field:{name:"dataQueryDatasourceApiId",valueChange({form:o,formData:a}){y(()=>{var i;a.dataQueryDatasourceApiId&&(o.datasourceApiName=(i=a.dataQueryDatasourceApiId)==null?void 0:i.name)})}},element:{comp:"PtSelect",formItemProps:{label:"\u6570\u636E\u67E5\u8BE2\u6570\u636E\u6E90\u63A5\u53E3",required:!0},compProps:{dataMethod:I}}}],tableColumns:[{prop:"outputKey",label:"\u805A\u5408\u53D8\u91CF"},{prop:"datasourceApiName",label:"\u6570\u636E\u67E5\u8BE2\u6570\u636E\u6E90\u63A5\u53E3"}]});J(()=>{u.initJsonStr&&(t.initJson=JSON.parse(u.initJsonStr))});const e=g({buttonText:"\u6DFB\u52A0\u793A\u4F8B"}),c=()=>{let o={outputKey:t.form.outputKey,dataQueryDatasourceApiId:t.form.dataQueryDatasourceApiId,datasourceApiName:t.form.datasourceApiName};console.log("item",o),t.initJson.aggregationItems.push(o)},p=({row:o,column:a,$index:i})=>i<0?[]:[{txt:"\u5220\u9664",text:!0,methodConfirmText:`\u786E\u5B9A\u8981\u5220\u9664 ${o.name} \u5417\uFF1F`,method(){t.initJson.aggregationItems.splice(i,1)}}];return A({getInitJson:()=>t.initJson}),(o,a)=>{const i=d("PtForm"),b=d("PtButtonGroup"),r=d("el-table-column"),F=d("PtTable");return E(),B(D,null,[s(i,{form:t.form,formData:t.formData,class:"pt-wdith-100-pc",method:c,defaultButtonsShow:"submit,reset",submitAttrs:e.value,layout:1,comps:t.formComps},null,8,["form","formData","submitAttrs","comps"]),s(F,{ref_key:"tableRef",ref:n,options:t.initJson.aggregationItems,columns:t.tableColumns},{defaultAppend:m(()=>[s(r,{label:"\u64CD\u4F5C",width:"180"},{default:m(({row:_,column:f,$index:h})=>[s(b,{options:p({row:_,column:f,$index:h})},null,8,["options"])]),_:1})]),_:1},8,["options","columns"])],64)}}}),N=C({name:"AdaptCustomScriptConfig"}),T=C({...N,props:{initJsonStr:{type:String},onSubmit:{type:Function,default:()=>({})}},setup(l,{expose:A}){const u=l,n=S({form:{}}),t=[{field:{name:"customScriptType"},element:{comp:"PtDictFrontSelect",formItemProps:{label:"\u811A\u672C\u7C7B\u578B",required:!0},compProps:{dictParam:{groupCode:"dataquery_data_api_custom_script_type"},props:{value:"value"}}}},{field:{name:"scriptTemplate"},element:{comp:"el-input",formItemProps:{label:"\u811A\u672C\u5185\u5BB9",required:!0,tips:'groovy\u793A\u4F8B\uFF1Adef map = new HashMap();map.put("result1",datasourceApi.invoke("datasourceApiCode",data));map; \u4EE5\u4E0A\u4E3A\u63A5\u53E3\u805A\u5408\u793A\u4F8B\uFF0C\u5176\u4E2D datasourceApi \u5305\u62EC\u4E24\u4E2A\u53C2\u6570 \u53C2\u65701=\u6570\u636E\u67E5\u8BE2\u6570\u636E\u6E90\u63A5\u53E3\u7F16\u7801\uFF0C2=\u8BF7\u6C42\u53C2\u6570\uFF0Cdata\u53D8\u91CF\u4E3A\u8BF7\u6C42\u53C2\u6570\u53E5\u67C4,\u6700\u540E map \u9700\u8981\u8FD4\u56DE\u5904\u7406\u7ED3\u679C'},compProps:{type:"textarea",rows:15,clearable:!0}}}];J(()=>{if(u.initJsonStr){let p=JSON.parse(u.initJsonStr);for(let o in p)n.form[o]=p[o]}});const e=g({buttonText:"\u786E\u8BA4"}),c=()=>{u.onSubmit()};return A({form:n.form}),(p,o)=>{const a=d("PtForm");return E(),P(a,{ref:"selfFormRef",form:n.form,class:"pt-wdith-100-pc",method:c,defaultButtonsShow:"submit,reset",submitAttrs:e.value,layout:1,comps:t},null,8,["form","submitAttrs"])}}}),k=v("div",{id:"dataqueryDatasourceApiAdaptCustomScriptConfigDialogFooter"},null,-1),R=C({name:"DataQueryDatasApiFormItemConfigs"}),Q=C({...R,props:{form:{type:Object,required:!0},formData:{type:Object,required:!0}},setup(l,{expose:A}){const u=l,n=g(null),t=g(null),e=S({adaptMultipleAggregationConfigJson:{dialogVisible:!1},adaptCustomScriptConfig:{dialogVisible:!1}}),c=b=>JSON.stringify(b),p=()=>{n.value.getInitJson().aggregationItems.length>0?u.form.adaptConfigJson=c(n.value.getInitJson()):u.form.adaptConfigJson="",e.adaptMultipleAggregationConfigJson.dialogVisible=!1},o=()=>{u.form.adaptConfigJson=c(t.value.form),e.adaptCustomScriptConfig.dialogVisible=!1},a=g(!1),i=()=>{y(()=>{a.value=!0})};return A({reactiveData:e}),(b,r)=>{const F=d("PtButton"),_=d("el-dialog");return E(),B(D,null,[s(_,{modelValue:e.adaptMultipleAggregationConfigJson.dialogVisible,"onUpdate:modelValue":r[0]||(r[0]=f=>e.adaptMultipleAggregationConfigJson.dialogVisible=f),width:"70%",title:"\u591A\u63A5\u53E3\u805A\u5408\u914D\u7F6EJson","append-to-body":"","destroy-on-close":""},{footer:m(()=>[v("span",null,[s(F,{type:"primary",onClick:p},{default:m(()=>[V("\u786E\u8BA4")]),_:1})])]),default:m(()=>[s(x,{ref_key:"adaptMultipleAggregationConfigRef",ref:n,initJsonStr:l.form.adaptConfigJson},null,8,["initJsonStr"])]),_:1},8,["modelValue"]),s(_,{modelValue:e.adaptCustomScriptConfig.dialogVisible,"onUpdate:modelValue":r[1]||(r[1]=f=>e.adaptCustomScriptConfig.dialogVisible=f),width:"70%",title:"\u81EA\u5B9A\u4E49\u811A\u672C\u914D\u7F6EJson",onOpen:i,onClosed:r[2]||(r[2]=f=>a.value=!1),"append-to-body":"","destroy-on-close":""},{footer:m(()=>[k]),default:m(()=>[a.value?(E(),P(T,{key:0,ref_key:"adaptCustomScriptConfigConfigRef",ref:t,initJsonStr:l.form.adaptConfigJson,onSubmit:o,buttonsTeleportProps:{disabled:!1,to:"#dataqueryDatasourceApiAdaptCustomScriptConfigDialogFooter"}},null,8,["initJsonStr"])):w("",!0)]),_:1},8,["modelValue"])],64)}}});export{Q as _};
