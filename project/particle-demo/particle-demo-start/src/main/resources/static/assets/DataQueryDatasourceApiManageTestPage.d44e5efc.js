import{l as g,m as a,h as l,n as P}from"./dataQueryDatasourceApiManage.65f4baec.js";import{d as C,r as p,a as b,a8 as h,b as c,o as v,c as A,e as d,F as S,X as T}from"./index.853052ed.js";import"./dataQueryDatasourceAdminApi.508371ab.js";import"./dataqueryProviderCompItem.fe1b283a.js";import"./dataQueryProviderAdminApi.30aa2513.js";const D=C({name:"DataQueryDatasourceApiManageTestPage"}),M=C({...D,props:{dataQueryDatasourceApiId:{type:String,required:!0}},setup(f){const i=f;let m=(u,e="success")=>{T({showClose:!0,message:u,type:e,showIcon:!0,grouping:!0})};const r=p(""),o=b({form:{param:""},formComps:[{field:{name:"name",valueChange({form:u,formData:e}){h(()=>{e.name&&(r.value==="queryString"?u.queryString=e.name.content:u.param=e.name.content)})}},element:{comp:"PtSelect",formItemProps:{label:"\u7528\u4F8B\u540D\u79F0",tips:"\u9009\u62E9\u4E00\u4E2A\u7528\u4F8B\u6570\u636E\u4F5C\u4E3A\u53C2\u6570\uFF0C\u9ED8\u8BA4\u9009\u4E2D\u7B2C\u4E00\u4E2A"},compProps:{clearable:!0,defaultValueItem:u=>!0,props:{value:"name"},dataMethod:()=>g({id:i.dataQueryDatasourceApiId}).then(u=>{let e=u.data.data;r.value=e.inParamTypeDictValue;let s=[];return e.inParamTestCaseDataConfigJson&&(s=JSON.parse(e.inParamTestCaseDataConfigJson).inParamTestCases),Promise.resolve(s)})}}},{field:{name:"param"},element:{comp:"el-input",formItemProps:{label:"\u53C2\u6570",displayBlock:!0},compProps:{type:"textarea",rows:15}}},{field:{name:"queryString"},element:{comp:"el-input",formItemProps:{label:"\u67E5\u8BE2\u5B57\u7B26\u4E32",displayBlock:!0},compProps:{clearable:!0,placeholder:"\u4EC5http\u652F\u6301"}}}],testResult:{value:""}}),F=p({buttonText:"\u67E5\u8BE2",permission:"admin:web:dataQueryDatasourceApi:test",beforeMethod:()=>{let u=o.form.param,e=o.form.queryString;if(r.value){if(!u&&!e){m("\u63A5\u53E3\u9700\u8981\u8BF7\u6C42\u53C2\u6570\uFF0C\u8BF7\u586B\u5199","error");return}try{e&&a.queryString(e)}catch{m("\u6570\u636E\u67E5\u8BE2\u53C2\u6570\u683C\u5F0F\u9519\u8BEF\uFF0C\u63A5\u53E3\u5B9A\u4E49\u7684\u5165\u53C2\u7C7B\u578B\u548C\u8F93\u5165\u53C2\u6570\u8F6C\u6362\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\uFF01","error");return}try{u&&r.value!="queryString"&&a[r.value](u)}catch{m("\u53C2\u6570\u683C\u5F0F\u9519\u8BEF\uFF0C\u63A5\u53E3\u5B9A\u4E49\u7684\u5165\u53C2\u7C7B\u578B\u548C\u8F93\u5165\u53C2\u6570\u8F6C\u6362\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\uFF01","error");return}}return!0}}),y=u=>{let e=u.param,s=u.queryString,t={dataQueryDatasourceApiId:i.dataQueryDatasourceApiId,param:null,queryString:s||null};if(r.value)if(r.value!="queryString")t.param=a[r.value](e);else{try{t.param=a[l.object](e)}catch{}if(!t.param)try{t.param=a[l.array](e)}catch{}if(!t.param)try{t.param=a[l.float](e)}catch{}if(!t.param)try{t.param=a[l.number](e)}catch{}if(!t.param)try{t.param=a[l.boolean](e)}catch{}if(!(t.param===!0||t.param===!1))try{t.param=a[l.string](e)}catch{}}return P(t)},E=u=>{let e=u.data;return o.testResult.value=JSON.stringify(e,null,"   "),"\u6570\u636E\u67E5\u8BE2\u6210\u529F"},B=()=>{o.testResult.value=""};return(u,e)=>{const s=c("PtForm"),t=c("PtAceEditor");return v(),A(S,null,[d(s,{form:o.form,method:y,methodSuccess:E,defaultButtonsShow:"submit,reset",submitAttrs:F.value,labelWidth:"100",buttonsTeleportProps:u.$route.meta.formButtonsTeleportProps,onResetForm:B,inline:"",layout:1,comps:o.formComps},null,8,["form","submitAttrs","buttonsTeleportProps","comps"]),d(t,{modelValue:o.testResult.value,"onUpdate:modelValue":e[0]||(e[0]=n=>o.testResult.value=n),mode:"ace/mode/json",class:"pt-width-100-pc"},null,8,["modelValue"])],64)}}});export{M as default};
