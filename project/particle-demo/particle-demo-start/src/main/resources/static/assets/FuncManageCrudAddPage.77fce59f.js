import{l as x,c as I,d as h}from"./funcAdminApi.7f00bf0e.js";import{l as D}from"./funcGroupAdminApi.dec311b2.js";import{d as p,a as E,r as i,$ as S,a0 as v,b as A,o as C,h as y,I as B}from"./index.147a787d.js";const _=p({name:"FuncManageCrudAddPage"}),T=p({..._,props:{parentId:{type:String}},setup(s){const m=s,u=E({form:{},formData:{}}),a=[{codeSuffix:"query",nameSuffix:"\u67E5\u8BE2",permissionSuffix:"pageQuery"},{codeSuffix:"create",nameSuffix:"\u6DFB\u52A0",permissionSuffix:"create"},{codeSuffix:"delete",nameSuffix:"\u5220\u9664",permissionSuffix:"delete"},{codeSuffix:"update",nameSuffix:"\u4FEE\u6539",permissionSuffix:"update"}],c=i([{field:{name:"items",value:a.map(e=>e.nameSuffix)},element:{comp:"PtCheckboxGroup",formItemProps:{label:"\u9879\u76EE",required:!0},compProps:{dataMethod:()=>a,props:{value:"nameSuffix",label:"nameSuffix"},dataMethodResultHandle:b}}},{field:{name:"codePrefix"},element:{comp:"el-input",formItemProps:{label:"\u7F16\u7801\u524D\u7F00",required:!0},compProps:{clearable:!0,placeholder:"\u5982\uFF1Auser_manage_"}}},{field:{name:"namePrefix"},element:{comp:"el-input",formItemProps:{label:"\u540D\u79F0\u524D\u7F00",required:!0},compProps:{clearable:!0,placeholder:"\u5982\uFF1A\u7528\u6237"}}},{field:{name:"permissionPrefix"},element:{comp:"el-input",formItemProps:{label:"\u6743\u9650\u7801\u524D\u7F00",required:!0},compProps:{clearable:!0,placeholder:"\u5982\uFF1Aadmin:web:user:"}}},{field:{name:"funcGroupId",value:""},element:{comp:"PtSelect",formItemProps:{label:"\u529F\u80FD\u5206\u7EC4",required:!0},compProps:{clearable:!0,dataMethod:D}}},{field:{name:"icon",value:"Link"},element:{comp:"el-input",formItemProps:{label:"\u56FE\u6807"},compProps:({form:e})=>{let t="Link";return S[e.icon]&&(t=e.icon),{clearable:!0,placeholder:"\u4EC5\u652F\u6301\u5185\u7F6E\u56FE\u6807\u540D\u79F0",prefixIcon:t}}}},{field:{name:"isDisabled",value:!1},element:{comp:"el-switch",formItemProps:{label:"\u662F\u5426\u7981\u7528"},compProps:{activeText:"\u7981\u7528",inactiveText:"\u542F\u7528"}}},{field:{name:"disabledReason"},element:{comp:"el-input",formItemProps:{label:"\u7981\u7528\u539F\u56E0",required:({form:e})=>e.isDisabled==!0},compProps:{clearable:!0}}},{field:{name:"isShow",value:!0},element:{comp:"el-switch",formItemProps:{label:"\u662F\u5426\u5C55\u793A"},compProps:{activeText:"\u5C55\u793A",inactiveText:"\u9690\u85CF"}}},{field:{name:"parentId"},element:{comp:"PtCascader",formItemProps:{label:"\u7236\u7EA7",required:!0},compProps:{clearable:!0,dataMethod:()=>x({}),dataMethodResultHandleConvertToTree:!0}}},{field:{name:"typeDictId"},element:{comp:"PtDictFrontSelect",formItemProps:{label:"\u7C7B\u578B",required:!0},compProps:{clearable:!0,dictParam:{groupCode:"func_type"},defaultValueItem:e=>e.value=="button"}}},{field:{name:"url"},element:{comp:"el-input",formItemProps:{label:"\u8DEF\u7531",rules:[{validator:(e,t,o)=>{var r;!t&&((r=u.formData.typeDictId)==null?void 0:r.value)=="page"?o(new Error("\u8DEF\u7531\u4E0D\u80FD\u4E3A\u7A7A")):o()},trigger:"blur"}],required:({formData:e})=>{var t;return((t=e.typeDictId)==null?void 0:t.value)=="page"}},compProps:{clearable:!0,placeholder:"\u5982\uFF1A/admin/user/add"}}},{field:{name:"seq",value:10},element:{comp:"el-input-number",formItemProps:{label:"\u6392\u5E8F"},compProps:{clearable:!0}}},{field:{name:"componentOf"},element:{comp:"el-input",formItemProps:{label:"\u5F52\u5C5E\u7EC4\u4EF6",required:!0},compProps:{clearable:!0}}},{field:{name:"remark"},element:{comp:"el-input",formItemProps:{label:"\u63CF\u8FF0"},compProps:{clearable:!0}}}]),f=i({buttonText:"\u786E\u8BA4\u6DFB\u52A0",permission:"admin:web:func:create"}),d=async e=>{let t=e.items;for(let o=0;o<t.length;o++){let r=B(e);try{delete r.items,delete r.codePrefix,delete r.namePrefix,delete r.permissionPrefix,Reflect.deleteProperty(r,"items"),Reflect.deleteProperty(r,"codePrefix"),Reflect.deleteProperty(r,"namePrefix"),Reflect.deleteProperty(r,"permissionPrefix")}catch{}let l=a.find(n=>n.nameSuffix==t[o]);r.code=e.codePrefix+l.codeSuffix,r.name=e.namePrefix+l.nameSuffix,r.permissions=e.permissionPrefix+l.permissionSuffix,await I(r)}},P=()=>{!m.parentId||h({id:m.parentId}).then(e=>{let t=e.data.data;u.form.funcGroupId=t.funcGroupId,u.form.parentId=t.id,u.form.codePrefix=t.code+"_",u.form.namePrefix=t.name,u.form.componentOf=t.componentOf})},F=()=>"\u6DFB\u52A0\u6210\u529F\uFF0C\u8BF7\u5237\u65B0\u6570\u636E\u67E5\u770B";function b({success:e}){return e}return v(()=>{P()}),(e,t)=>{const o=A("PtForm");return C(),y(o,{form:u.form,formData:u.formData,labelWidth:"80",method:d,methodSuccess:F,defaultButtonsShow:"submit,reset",submitAttrs:f.value,buttonsTeleportProps:e.$route.meta.formButtonsTeleportProps,inline:"",layout:[1],comps:c.value},null,8,["form","formData","submitAttrs","buttonsTeleportProps","comps"])}}});export{T as default};
