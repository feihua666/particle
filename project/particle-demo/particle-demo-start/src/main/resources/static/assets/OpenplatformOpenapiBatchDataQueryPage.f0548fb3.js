import{b as V,e as S,f as q}from"./openplatformOpenapiCompItem.769730b1.js";import{a as M}from"./openplatformAppCompItem.a96f66dc.js";import{e as v,a as W,d as x}from"./FileTools.94b84ff7.js";import{d as w,r as f,a as G,b as l,o as A,c as R,e as o,w as c,f as K,W as L,F as X,X as j,b1 as z,b2 as H,b3 as g,b4 as J}from"./index.00897985.js";import{t as Y,d as Z}from"./openplatformOpenapiBatchQueryRecordAdminApi.d681ef6f.js";import"./openplatformAppAdminApi.e8cd8060.js";import"./crmCompItem.7d33bbab.js";import"./crmCustomerTagAdminApi.dfeeeb7c.js";const $={key:0},ee=w({name:"OpenplatformOpenapiBatchDataQueryPage"}),ie=w({...ee,setup(te){let C=(e,t="success")=>{j({showClose:!0,message:e,type:t,showIcon:!0,grouping:!0})};const E=f(null),n=f(null),u=G({form:{},formComps:[M({label:"\u5E94\u7528",required:!0,valueChange:({form:e,newValue:t})=>{t||(e.openplatformOpenapiId=null)},tips:" 1. \u8BF7\u5148\u9009\u62E9\u8981\u4F7F\u7528\u7684\u5E94\u7528"}),V({fieldName:"openplatformOpenapiId",label:"\u5F00\u653E\u63A5\u53E3",required:!0,disableGroup:!0,valueChange:({form:e,newValue:t})=>{},tips:" 2. \u8BF7\u9009\u62E9\u8981\u67E5\u8BE2\u7684\u63A5\u53E3"})],templateform:{},templateformComps:[{field:{name:"file",value:[]},element:{comp:"PtUpload",formItemProps:{label:"\u67E5\u8BE2\u6587\u4EF6",required:!0,displayBlock:!0},compProps:{drag:!0,autoUpload:!1,limit:1,dragTip:"\u5C06\u6587\u4EF6\u62D6\u5230\u6B64\u5904\u6216<em>\u70B9\u51FB\u4E0A\u4F20</em>",tipTxt:"\u53EA\u80FD\u4E0A\u4F20\u4E00\u4E2A\u6587\u4EF6\uFF0C\u8BF7\u4E25\u683C\u6309\u7167\u4E0B\u8F7D\u7684\u6A21\u677F\u8FDB\u884C\u586B\u5199\uFF0C\u5E76\u4FDD\u8BC1\u7B2C\u4E00\u4E2Asheet\u4E3A\u67E5\u8BE2\u53C2\u6570",onExceed:(e,t)=>{C("\u6700\u591A\u53EA\u80FD\u9009\u62E9\u4E00\u4E2A\u6587\u4EF6,\u5982\u8981\u91CD\u65B0\u9009\u62E9\uFF0C\u8BF7\u5148\u5220\u9664\u4E4B\u524D\u7684\u6587\u4EF6","error")}}}},{field:{name:"remark"},element:{comp:"el-input",formItemProps:{label:"\u5907\u6CE8",required:!0,displayBlock:!0},compProps:{clearable:!0}}}],openplatformOpenapiBatchQueryRecordId:null,tableColumns:Y,tableData:[]}),s=f({buttonText:"\u67E5\u8BE2",loading:!1,permission:"admin:web:openplatformOpenapi:batchQuery"}),O=()=>{D(()=>{y(()=>{s.value.loading=!0,P().then(e=>{let t=e.data.data;u.openplatformOpenapiBatchQueryRecordId=t.id,Q(u.openplatformOpenapiBatchQueryRecordId),C("\u67E5\u8BE2\u6210\u529F,\u60A8\u53EF\u5728\u5F53\u524D\u9875\u9762\u5237\u65B0\u7ED3\u679C\u72B6\u6001\u6216\u7A0D\u5019\u524D\u5F80\u6279\u91CF\u67E5\u8BE2\u8BB0\u5F55\u67E5\u770B\u7ED3\u679C")}).finally(()=>{s.value.loading=!1})})}),y(()=>{})},D=e=>{E.value&&E.value.formRef.validate((t,a)=>{t&&e()})},y=e=>{n.value&&n.value.formRef.validate((t,a)=>{t&&e()})},P=()=>{let e=new FormData;for(let t in u.form)e.append(t,u.form[t]);return e.append("file",u.templateform.file[0].raw),e.append("remark",u.templateform.remark),q(e)},I=()=>{n.value&&n.value.resetForm()},F=f(!1),T=()=>{D(()=>{F.value=!0;let e={};for(let t in u.form)e[t]=u.form[t];S(e).then(t=>{let a=t.data,p=v(t),r=W(t);r=decodeURIComponent(r),x(a,p,r)}).finally(()=>{F.value=!1})})},Q=e=>{g(u.tableData),_(e).then(t=>{u.tableData=[t.data.data]})},k=e=>_(e).then(t=>{for(let a=0;a<u.tableData.length;a++)u.tableData[a].id==e&&J(u.tableData,a,t.data.data);return Promise.resolve(t)}),_=e=>Z({id:e}),N=({row:e,column:t,$index:a})=>{if(a<0)return[];e.id;let p={openplatformOpenapiBatchQueryRecordId:e.id};return[{txt:"\u5237\u65B0",text:!0,method(){return k(u.openplatformOpenapiBatchQueryRecordId)}},{txt:"\u4E0B\u8F7D",text:!0,disabled:e.executeStatusDictValue!="finished",disabledReason:e.executeStatusDictValue!="finished"?"\u6267\u884C\u5B8C\u6210\u540E\u624D\u53EF\u80FD\u4E0B\u8F7D":void 0,method(){let m=z(e.exportFileUrl),B=m.substring(m.lastIndexOf("/")+1);return H(m).then(i=>{let b=i.data,d=v(i),h=decodeURIComponent(B);return x(b,d,h),Promise.resolve(i)})}},{txt:"\u67E5\u770B\u8BE6\u60C5",text:!0,position:"more",permission:"admin:web:openplatformOpenapiBatchQueryRecordDetail:pageQuery",route:{path:"/admin/openplatformOpenapiBatchQueryRecordDetail1",query:p}},{txt:"\u5220\u9664",text:!0,position:"more",methodConfirmText:"\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u6570\u636E\u5417\uFF1F\u5220\u9664\u540E\u60A8\u53EF\u4EE5\u524D\u5F80\u6279\u91CF\u67E5\u8BE2\u8BB0\u5F55\u67E5\u770B\u7ED3\u679C",method(){u.openplatformOpenapiBatchQueryRecordId=null,g(u.tableData)}}]};return(e,t)=>{const a=l("PtForm"),p=l("PtButton"),r=l("PtButtonGroup"),m=l("el-table-column"),B=l("PtTable"),i=l("el-alert"),b=l("PtRouteViewPopover");return A(),R(X,null,[o(a,{ref_key:"formRef",ref:E,form:u.form,labelWidth:"120",defaultButtonsShow:"",inline:"",layout:2,comps:u.formComps},null,8,["form","comps"]),o(a,{ref_key:"templateFormRef",ref:n,form:u.templateform,labelWidth:"120",defaultButtonsShow:"",inline:"",layout:1,comps:u.templateformComps},null,8,["form","comps"]),o(a,{form:[],labelWidth:"120",method:O,defaultButtonsShow:"submit,reset",submitAttrs:s.value,inline:"",showButtonItem:!0,onResetForm:I,comps:[]},{buttons:c(()=>[o(p,{permission:"admin:web:openplatformOpenapi:batchQuery",loading:F.value,method:T},{default:c(()=>[K("\u4E0B\u8F7D\u6A21\u677F")]),_:1},8,["loading"])]),_:1},8,["submitAttrs"]),u.openplatformOpenapiBatchQueryRecordId?(A(),R("div",$,[o(B,{ref:"tableRef","default-expand-all":"",data:u.tableData,onDataMethodDataLoading:t[0]||(t[0]=d=>s.value.loading=d),columns:u.tableColumns},{defaultAppend:c(()=>[o(m,{label:"\u64CD\u4F5C",width:"220"},{default:c(({row:d,column:h,$index:U})=>[o(r,{options:N({row:d,column:h,$index:U}),dropdownTriggerButtonOptions:{text:!0,buttonText:"\u66F4\u591A"}},null,8,["options"])]),_:1})]),_:1},8,["data","columns"]),o(i,{title:"\u6CE8\u610F\uFF1A\u4EE5\u4E0A\u8868\u683C\u4EC5\u5C55\u793A\u6700\u540E\u4E00\u6B21\u67E5\u8BE2\u7684\u67E5\u8BE2\u7ED3\u679C",type:"info",style:{width:"350px","margin-top":"10px"}})])):L("",!0),o(b,{level:3})],64)}}});export{ie as default};
