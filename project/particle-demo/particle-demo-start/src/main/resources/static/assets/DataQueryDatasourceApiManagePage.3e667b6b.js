import{p as y,a as P,r as _,d as g,b as Q,c as T,e as M,f as R}from"./dataQueryDatasourceApiManage.b70862e7.js";import{d as D,r as c,a as S,b as s,o as k,c as w,e as i,w as m,f as N,F as V}from"./index.cfa27f61.js";import"./dataQueryDatasourceAdminApi.47cdc471.js";import"./dataqueryProviderCompItem.7da6373e.js";import"./dataQueryProviderAdminApi.239d3248.js";const $=D({name:"DataQueryDatasourceApiManagePage"}),I=D({...$,props:{name:{type:String}},setup(E){const b=E,F=c(null),r=S({form:{name:b.name},formComps:y,tableColumns:[{prop:"code",label:"\u7F16\u7801"},{prop:"name",label:"\u540D\u79F0"},{prop:"categoryDictName",label:"\u5206\u7C7B"},{prop:"dataQueryProviderName",label:"\u6570\u636E\u67E5\u8BE2\u4F9B\u5E94\u5546"},{prop:"dataQueryProviderDocLinkUrl",label:"\u6587\u6863\u94FE\u63A5",showOverflowTooltip:!0},{prop:"dataQueryDatasourceName",label:"\u6570\u636E\u67E5\u8BE2\u6570\u636E\u6E90"},{prop:"readTimeout",label:"\u8BFB\u53D6\u7B49\u5F85\u65F6\u95F4(ms)"},{prop:"connectTimeout",label:"\u8FDE\u63A5\u7B49\u5F85\u65F6\u95F4(ms)"},{prop:"sameTag",label:"\u7B49\u540C\u6807\u7B7E"},{prop:"isSupportTrans",label:"\u7FFB\u8BD1\u652F\u6301",formatter:(u,o,t,a)=>t?"\u652F\u6301":"\u4E0D\u652F\u6301"},{prop:"isPublished",label:"\u662F\u5426\u53D1\u5E03",formatter:(u,o,t,a)=>t?"\u5DF2\u53D1\u5E03":"\u672A\u53D1\u5E03"},{prop:"isMaster",label:"\u914D\u7F6E\u5206\u652F",formatter:(u,o,t,a)=>t?"master":"dev"},{prop:"isTestPassed",label:"\u662F\u5426\u6D4B\u8BD5\u901A\u8FC7",formatter:(u,o,t,a)=>t?"\u6D4B\u8BD5\u901A\u8FC7":"\u672A\u6D4B\u8BD5\u901A\u8FC7"},{prop:"remark",label:"\u63CF\u8FF0"}]}),p=c({buttonText:"\u67E5\u8BE2",loading:!1,permission:"admin:web:dataQueryDatasourceApi:pageQuery"}),n=()=>{F.value.refreshData()},B=({pageQuery:u})=>P({...r.form,...u}),A={permission:p.value.permission},h=({row:u,column:o,$index:t})=>{if(t<0)return[];let a={id:u.id},d=[{txt:"\u63A5\u53E3\u6D4B\u8BD5",text:!0,permission:"admin:web:dataQueryDatasourceApi:test",route:{path:"/admin/DataQueryDatasourceApiManageTest",query:a}},{txt:"\u7F16\u8F91",text:!0,disabled:u.isPublished,disabledReason:u.isPublished?"\u5DF2\u53D1\u5E03\u4E0D\u80FD\u7F16\u8F91\uFF0C\u53EF\u4EE5\u901A\u8FC7\u590D\u5236dev\u6765\u4FEE\u6539\u63D0\u4EA4":void 0,permission:"admin:web:dataQueryDatasourceApi:update",position:"more",route:{path:"/admin/DataQueryDatasourceApiManageUpdate",query:a}},{txt:"\u5220\u9664",text:!0,disabled:u.isPublished,disabledReason:u.isPublished?"\u5DF2\u53D1\u5E03\u4E0D\u80FD\u5220\u9664":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:delete",methodConfirmText:`\u53EF\u80FD\u5B58\u5728\u6570\u636E\u67E5\u8BE2\u5F15\u7528\uFF08\u5305\u62EC\u76F4\u8FDE\u5F15\u7528\u6216\u901A\u8FC7\u7F16\u7801\u811A\u672C\u8C03\u7528\uFF09\u8BF7\u786E\u4FDD\u5B89\u5168\uFF0C\u786E\u5B9A\u8981\u5220\u9664 ${u.name} \u5417\uFF1F`,method(){return _({id:u.id}).then(e=>(n(),Promise.resolve(e)))}},{txt:"\u5220\u9664\u7F13\u5B58",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:deleteCache",methodConfirmText:`\u786E\u5B9A\u8981\u5220\u9664 ${u.name} \u7F13\u5B58\u5417\uFF1F\u5982\u679C\u90E8\u7F72\u591A\u4E2A\u5B9E\u4F8B\u53EF\u80FD\u8981\u591A\u6B21\u6267\u884C`,methodSuccess:e=>"\u5220\u9664\u7F13\u5B58\u6210\u529F "+e.data.data,method(){return g({id:u.id}).then(e=>Promise.resolve(e))}},{txt:"\u5237\u65B0\u7F13\u5B58",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:refreshCache",methodSuccess:e=>"\u5237\u65B0\u7F13\u5B58\u6210\u529F\uFF0C\u5982\u679C\u90E8\u7F72\u591A\u4E2A\u5B9E\u4F8B\u53EF\u80FD\u8981\u591A\u6B21\u6267\u884C\u3002 "+e.data.data,method(){return Q({id:u.id}).then(e=>Promise.resolve(e))}},{txt:"\u590D\u5236",text:!0,disabled:!u.isMaster,disabledReason:u.isMaster?void 0:"\u4EC5\u652F\u6301master\u590D\u5236",position:"more",permission:"admin:web:dataQueryDatasourceApi:copy",methodConfirmText:`\u786E\u5B9A\u8981\u590D\u5236 ${u.name} \u5417\uFF1F`,methodSuccess:e=>{r.form.name=e.data.data.name,n()},method(){return T({id:u.id}).then(e=>Promise.resolve(e))}},{txt:"\u590D\u5236dev",text:!0,disabled:!u.isMaster,disabledReason:u.isMaster?void 0:"\u4EC5\u652F\u6301master\u590D\u5236",position:"more",permission:"admin:web:dataQueryDatasourceApi:copydev",methodConfirmText:`\u786E\u5B9A\u8981\u590D\u5236 ${u.name} \u5417\uFF1F\u590D\u5236\u540E\u53EF\u4EE5\u4FEE\u6539\u5E76\u63D0\u4EA4\u5230\u4E3B\u5206\u652F`,methodSuccess:e=>{r.form.name=e.data.data.name,n()},method(){return M({id:u.id}).then(e=>Promise.resolve(e))}},{txt:"\u67E5\u770B",text:!0,permission:"admin:web:dataQueryDatasourceApi:detail",position:"more",route:{path:"/admin/DataQueryDatasourceApiManageView",query:a}}];return u.isMaster||d.push({txt:"\u63D0\u4EA4\u81F3master",text:!0,disabled:u.isMaster,disabledReason:u.isMaster?"\u4EC5\u652F\u6301dev":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:devMergeToMaster",methodConfirmText:`\u786E\u5B9A\u8981\u5C06 ${u.name} \u63D0\u4EA4\u81F3master\u5417\uFF1F\u63D0\u4EA4\u6210\u529F\u540E\u672C\u6570\u636E\u5C06\u4F1A\u88AB\u5220\u9664\uFF01`,methodSuccess:e=>{n()},method(){return R({id:u.id}).then(e=>Promise.resolve(e))}}),d};return(u,o)=>{const t=s("PtButton"),a=s("PtForm"),d=s("PtButtonGroup"),e=s("el-table-column"),f=s("PtTable"),C=s("PtRouteViewPopover");return k(),w(V,null,[i(a,{form:r.form,method:n,defaultButtonsShow:"submit,reset",submitAttrs:p.value,labelWidth:"100",inline:"",comps:r.formComps},{buttons:m(()=>[i(t,{permission:"admin:web:dataQueryDatasourceApi:create",route:"/admin/DataQueryDatasourceApiManageAdd"},{default:m(()=>[N("\u6DFB\u52A0")]),_:1})]),_:1},8,["form","submitAttrs","comps"]),i(f,{ref_key:"tableRef",ref:F,"default-expand-all":"",dataMethod:B,onDataMethodDataLoading:o[0]||(o[0]=l=>p.value.loading=l),paginationProps:A,columns:r.tableColumns},{defaultAppend:m(()=>[i(e,{label:"\u64CD\u4F5C",width:"180"},{default:m(({row:l,column:x,$index:v})=>[i(d,{options:h({row:l,column:x,$index:v}),dropdownTriggerButtonOptions:{text:!0,buttonText:"\u66F4\u591A"}},null,8,["options"])]),_:1})]),_:1},8,["columns"]),i(C,{level:3})],64)}}});export{I as default};
