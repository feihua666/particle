import{l as h,m as r,h as m,n as v}from"./dataQueryDatasourceApiManage-DJz9rs9H.js";import{d as S,r as p,a as T,Q as C,b as c,o as q,c as A,e as d,F as D,G as I}from"./index-BGwvwH0Y.js";import"./dataQueryDatasourceAdminApi-BmP1aiws.js";import"./dataqueryProviderCompItem-ENNFY2LT.js";import"./dataQueryProviderAdminApi-B04x9YFL.js";const M=S({__name:"DataQueryDatasourceApiManageTestPage",props:{dataQueryDatasourceApiId:{type:String,required:!0}},setup(f){let u=(t,e="success")=>{I({showClose:!0,message:t,type:e,showIcon:!0,grouping:!0})};const i=f,o=p(""),s=T({form:{param:""},formComps:[{field:{name:"name",valueChange({form:t,formData:e}){C(()=>{e.name&&(o.value==="queryString"?t.queryString=e.name.content:t.param=e.name.content)})}},element:{comp:"PtSelect",formItemProps:{label:"用例名称",tips:"选择一个用例数据作为参数，默认选中第一个"},compProps:{clearable:!0,defaultValueItem:t=>!0,props:{value:"name"},dataMethod:()=>h({id:i.dataQueryDatasourceApiId}).then(t=>{let e=t.data.data;o.value=e.inParamTypeDictValue;let n=[];return e.inParamTestCaseDataConfigJson&&(n=JSON.parse(e.inParamTestCaseDataConfigJson).inParamTestCases),Promise.resolve(n)})}}},{field:{name:"param"},element:{comp:"el-input",formItemProps:{label:"参数",displayBlock:!0},compProps:{type:"textarea",rows:15}}},{field:{name:"queryString"},element:{comp:"el-input",formItemProps:{label:"查询字符串",displayBlock:!0},compProps:{clearable:!0,placeholder:"仅http支持"}}}],testResult:{value:""}}),y=p({buttonText:"查询",permission:"admin:web:dataQueryDatasourceApi:test",beforeMethod:()=>{let t=s.form.param,e=s.form.queryString;if(o.value){if(!t&&!e){u("接口需要请求参数，请填写","error");return}try{e&&r.queryString(e)}catch{u("数据查询参数格式错误，接口定义的入参类型和输入参数转换错误，请检查！","error");return}try{t&&o.value!="queryString"&&r[o.value](t)}catch{u("参数格式错误，接口定义的入参类型和输入参数转换错误，请检查！","error");return}}return!0}}),g=t=>{let e=t.param,n=t.queryString,a={dataQueryDatasourceApiId:i.dataQueryDatasourceApiId,param:null,queryString:n||null};if(o.value)if(o.value!="queryString")a.param=r[o.value](e);else{try{a.param=r[m.object](e)}catch{}if(!a.param)try{a.param=r[m.array](e)}catch{}if(!a.param)try{a.param=r[m.float](e)}catch{}if(!a.param)try{a.param=r[m.number](e)}catch{}if(!a.param)try{a.param=r[m.boolean](e)}catch{}if(!(a.param===!0||a.param===!1))try{a.param=r[m.string](e)}catch{}}return v(a)},P=t=>{let e=t.data;return s.testResult.value=JSON.stringify(e,null,"   "),"数据查询成功"},b=()=>{s.testResult.value=""};return(t,e)=>{const n=c("PtForm"),a=c("PtAceEditor");return q(),A(D,null,[d(n,{form:s.form,method:g,methodSuccess:P,defaultButtonsShow:"submit,reset",submitAttrs:y.value,labelWidth:"100",buttonsTeleportProps:t.$route.meta.formButtonsTeleportProps,onResetForm:b,inline:"",layout:1,comps:s.formComps},null,8,["form","submitAttrs","buttonsTeleportProps","comps"]),d(a,{modelValue:s.testResult.value,"onUpdate:modelValue":e[0]||(e[0]=l=>s.testResult.value=l),mode:"ace/mode/json",class:"pt-width-100-pc"},null,8,["modelValue"])],64)}}});export{M as default};
