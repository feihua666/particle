import{o as I}from"./dataQueryDatasourceApiManage.5d3aa8d4.js";import{d as C,r as g,a as y,a7 as S,ae as B,b as d,o as F,c as J,e as s,w as m,F as D,h as P,i as v,f as V,W as w}from"./index.858f5c96.js";const x=C({name:"AdaptMultipleAggregationConfig"}),M=C({...x,props:{initJsonStr:{type:String}},setup(l,{expose:A}){const u=l,n=g(null),t=y({initJson:{aggregationItems:[]},form:{datasourceApiName:""},formComps:[{field:{name:"outputKey"},element:{comp:"el-input",formItemProps:{label:"\u805A\u5408\u53D8\u91CF",required:!0,tips:"\u5C06\u4EE5\u8BE5\u53D8\u91CF\u505A\u4E3A\u8F93\u51FA\u5BF9\u8C61\u7684key"},compProps:{clearable:!0}}},{field:{name:"dataQueryDatasourceApiId",valueChange({form:e,formData:a}){S(()=>{var r;a.dataQueryDatasourceApiId&&(e.datasourceApiName=(r=a.dataQueryDatasourceApiId)==null?void 0:r.name)})}},element:{comp:"PtSelect",formItemProps:{label:"\u6570\u636E\u67E5\u8BE2\u6570\u636E\u6E90\u63A5\u53E3",required:!0},compProps:{dataMethod:I}}}],tableColumns:[{prop:"outputKey",label:"\u805A\u5408\u53D8\u91CF"},{prop:"datasourceApiName",label:"\u6570\u636E\u67E5\u8BE2\u6570\u636E\u6E90\u63A5\u53E3"}]});B(()=>{u.initJsonStr&&(t.initJson=JSON.parse(u.initJsonStr))});const o=g({buttonText:"\u6DFB\u52A0\u793A\u4F8B"}),c=()=>{let e={outputKey:t.form.outputKey,dataQueryDatasourceApiId:t.form.dataQueryDatasourceApiId,datasourceApiName:t.form.datasourceApiName};t.initJson.aggregationItems.push(e)},p=({row:e,column:a,$index:r})=>r<0?[]:[{txt:"\u5220\u9664",text:!0,methodConfirmText:`\u786E\u5B9A\u8981\u5220\u9664 ${e.name} \u5417\uFF1F`,method(){t.initJson.aggregationItems.splice(r,1)}}];return A({getInitJson:()=>t.initJson}),(e,a)=>{const r=d("PtForm"),b=d("PtButtonGroup"),i=d("el-table-column"),_=d("PtTable");return F(),J(D,null,[s(r,{form:t.form,formData:t.formData,class:"pt-wdith-100-pc",method:c,defaultButtonsShow:"submit,reset",submitAttrs:o.value,layout:1,comps:t.formComps},null,8,["form","formData","submitAttrs","comps"]),s(_,{ref_key:"tableRef",ref:n,options:t.initJson.aggregationItems,columns:t.tableColumns},{defaultAppend:m(()=>[s(i,{label:"\u64CD\u4F5C",width:"180"},{default:m(({row:E,column:f,$index:h})=>[s(b,{options:p({row:E,column:f,$index:h})},null,8,["options"])]),_:1})]),_:1},8,["options","columns"])],64)}}}),N=C({name:"AdaptCustomScriptConfig"}),k=C({...N,props:{initJsonStr:{type:String},onSubmit:{type:Function,default:()=>({})}},setup(l,{expose:A}){const u=l,n=y({form:{}}),t=[{field:{name:"customScriptType"},element:{comp:"PtDictFrontSelect",formItemProps:{label:"\u811A\u672C\u7C7B\u578B",required:!0},compProps:{dictParam:{groupCode:"dataquery_data_api_custom_script_type"},props:{value:"value"}}}},{field:{name:"scriptTemplate"},element:{comp:"el-input",formItemProps:{label:"\u811A\u672C\u5185\u5BB9",required:!0,tips:'groovy\u793A\u4F8B\uFF1Adef map = new HashMap();map.put("result1",datasourceApi.invoke("datasourceApiCode",data,queryStr));map; \u4EE5\u4E0A\u4E3A\u63A5\u53E3\u805A\u5408\u793A\u4F8B\uFF0C\u5176\u4E2D datasourceApi \u5305\u62EC\u4E09\u4E2A\u53C2\u6570 \u53C2\u65701=\u6570\u636E\u67E5\u8BE2\u6570\u636E\u6E90\u63A5\u53E3\u7F16\u7801\uFF0C2=\u8BF7\u6C42\u53C2\u6570\uFF0Cdata\u53D8\u91CF\u4E3A\u8BF7\u6C42\u53C2\u6570\u53E5\u67C4,3=\u67E5\u8BE2\u5B57\u7B26\u4E32\u53C2\u6570\uFF0C\u6700\u540E map \u9700\u8981\u8FD4\u56DE\u5904\u7406\u7ED3\u679C,\u652F\u6301\u4F7F\u7528dataQueryDataApiExecutor\u53E5\u67C4\u5F15\u7528\u7EBF\u7A0B\u6C60\u52A0\u901F\u5904\u7406'},compProps:{type:"textarea",rows:15,clearable:!0}}}];B(()=>{if(u.initJsonStr){let p=JSON.parse(u.initJsonStr);for(let e in p)n.form[e]=p[e]}});const o=g({buttonText:"\u786E\u8BA4"}),c=()=>{u.onSubmit()};return A({form:n.form}),(p,e)=>{const a=d("PtForm");return F(),P(a,{ref:"selfFormRef",form:n.form,class:"pt-wdith-100-pc",method:c,defaultButtonsShow:"submit,reset",submitAttrs:o.value,layout:1,comps:t},null,8,["form","submitAttrs"])}}}),R=v("div",{id:"dataqueryDatasourceApiAdaptCustomScriptConfigDialogFooter"},null,-1),T=C({name:"DataQueryDatasApiFormItemConfigs"}),Q=C({...T,props:{form:{type:Object,required:!0},formData:{type:Object,required:!0}},setup(l,{expose:A}){const u=l,n=g(null),t=g(null),o=y({adaptMultipleAggregationConfigJson:{dialogVisible:!1},adaptCustomScriptConfig:{dialogVisible:!1}}),c=b=>JSON.stringify(b),p=()=>{n.value.getInitJson().aggregationItems.length>0?u.form.adaptConfigJson=c(n.value.getInitJson()):u.form.adaptConfigJson="",o.adaptMultipleAggregationConfigJson.dialogVisible=!1},e=()=>{u.form.adaptConfigJson=c(t.value.form),o.adaptCustomScriptConfig.dialogVisible=!1},a=g(!1),r=()=>{S(()=>{a.value=!0})};return A({reactiveData:o}),(b,i)=>{const _=d("PtButton"),E=d("el-dialog");return F(),J(D,null,[s(E,{modelValue:o.adaptMultipleAggregationConfigJson.dialogVisible,"onUpdate:modelValue":i[0]||(i[0]=f=>o.adaptMultipleAggregationConfigJson.dialogVisible=f),width:"70%",title:"\u591A\u63A5\u53E3\u805A\u5408\u914D\u7F6EJson","append-to-body":"","destroy-on-close":""},{footer:m(()=>[v("span",null,[s(_,{type:"primary",onClick:p},{default:m(()=>[V("\u786E\u8BA4")]),_:1})])]),default:m(()=>[s(M,{ref_key:"adaptMultipleAggregationConfigRef",ref:n,initJsonStr:l.form.adaptConfigJson},null,8,["initJsonStr"])]),_:1},8,["modelValue"]),s(E,{modelValue:o.adaptCustomScriptConfig.dialogVisible,"onUpdate:modelValue":i[1]||(i[1]=f=>o.adaptCustomScriptConfig.dialogVisible=f),width:"70%",title:"\u81EA\u5B9A\u4E49\u811A\u672C\u914D\u7F6EJson",onOpen:r,onClosed:i[2]||(i[2]=f=>a.value=!1),"append-to-body":"","destroy-on-close":""},{footer:m(()=>[R]),default:m(()=>[a.value?(F(),P(k,{key:0,ref_key:"adaptCustomScriptConfigConfigRef",ref:t,initJsonStr:l.form.adaptConfigJson,onSubmit:e,buttonsTeleportProps:{disabled:!1,to:"#dataqueryDatasourceApiAdaptCustomScriptConfigDialogFooter"}},null,8,["initJsonStr"])):w("",!0)]),_:1},8,["modelValue"])],64)}}});export{Q as _};
