import{l as P,m as B,n as b}from"./dataQueryDatasourceApiManage.45d9f682.js";import{d as p,r as l,a as A,a6 as v,b as m,o as y,c as D,e as i,F as T,X as g}from"./index.30ac3b34.js";import"./dataQueryDatasourceAdminApi.fe73bb47.js";import"./dataqueryProviderCompItem.f1fa60ec.js";import"./dataQueryProviderAdminApi.08ee4002.js";const h=p({name:"DataQueryDatasourceApiManageTestPage"}),M=p({...h,props:{dataQueryDatasourceApiId:{type:String,required:!0}},setup(c){const o=c;let s=(t,e="success")=>{g({showClose:!0,message:t,type:e,showIcon:!0,grouping:!0})};const r=l(""),u=A({form:{param:""},formComps:[{field:{name:"name",valueChange({form:t,formData:e}){v(()=>{e.name&&(t.param=e.name.content)})}},element:{comp:"PtSelect",formItemProps:{label:"\u7528\u4F8B\u540D\u79F0",tips:"\u9009\u62E9\u4E00\u4E2A\u7528\u4F8B\u6570\u636E\u4F5C\u4E3A\u53C2\u6570\uFF0C\u9ED8\u8BA4\u9009\u4E2D\u7B2C\u4E00\u4E2A"},compProps:{clearable:!0,defaultValueItem:t=>!0,props:{value:"name"},dataMethod:()=>P({id:o.dataQueryDatasourceApiId}).then(t=>{let e=t.data.data;r.value=e.inParamTypeDictValue;let a=[];return e.inParamTestCaseDataConfigJson&&(a=JSON.parse(e.inParamTestCaseDataConfigJson).inParamTestCases),Promise.resolve(a)})}}},{field:{name:"param"},element:{comp:"el-input",formItemProps:{label:"\u53C2\u6570",displayBlock:!0},compProps:{type:"textarea",rows:15}}}],testResult:{value:""}}),d=l({buttonText:"\u67E5\u8BE2",permission:"admin:web:dataQueryDatasourceApi:test",beforeMethod:()=>{let t=u.form.param;if(r.value){if(!t){s("\u63A5\u53E3\u9700\u8981\u8BF7\u6C42\u53C2\u6570\uFF0C\u8BF7\u586B\u5199","error");return}try{t=B[r.value](t)}catch{s("\u53C2\u6570\u683C\u5F0F\u9519\u8BEF\uFF0C\u63A5\u53E3\u5B9A\u4E49\u7684\u5165\u53C2\u7C7B\u578B\u548C\u8F93\u5165\u53C2\u6570\u8F6C\u6362\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\uFF01","error");return}}return!0}}),C=t=>{let e=t.param;r.value?e=JSON.parse(e):e=null;let a={dataQueryDatasourceApiId:o.dataQueryDatasourceApiId,param:e};return b(a)},f=t=>{let e=t.data;return u.testResult.value=JSON.stringify(e,null,"   "),"\u6570\u636E\u67E5\u8BE2\u6210\u529F"},F=()=>{u.testResult.value=""};return(t,e)=>{const a=m("PtForm"),n=m("PtAceEditor");return y(),D(T,null,[i(a,{form:u.form,method:C,methodSuccess:f,defaultButtonsShow:"submit,reset",submitAttrs:d.value,labelWidth:"100",buttonsTeleportProps:t.$route.meta.formButtonsTeleportProps,onResetForm:F,inline:"",layout:1,comps:u.formComps},null,8,["form","submitAttrs","buttonsTeleportProps","comps"]),i(n,{modelValue:u.testResult.value,"onUpdate:modelValue":e[0]||(e[0]=E=>u.testResult.value=E),mode:"ace/mode/json",class:"pt-width-100-pc"},null,8,["modelValue"])],64)}}});export{M as default};
