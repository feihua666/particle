import{d as I,a as y,r as u,Y as h,W as g,Z as v,$ as q,b as D,o as T,g as E,h as _,U as M,a0 as w}from"./index-CmUqrYxc.js";const R=I({__name:"FuncManageCrudAddPage",props:{parentId:{type:String},codePrefix:{type:String},namePrefix:{type:String},permissionPrefix:{type:String},funcGroupId:{type:String},typeDictId:{type:String},componentOf:{type:String},createExtPermission:{type:String},deleteExtPermission:{type:String},updateExtPermission:{type:String},queryPageExtPermission:{type:String},isTree:{type:Boolean,default:!1}},setup(f){const o=f,i=y({form:{codePrefix:o.codePrefix,namePrefix:o.namePrefix,permissionPrefix:o.permissionPrefix,funcGroupId:o.funcGroupId,typeDictId:o.typeDictId,componentOf:o.componentOf},formData:{}}),m=[{codeSuffix:"query",nameSuffix:"查询",permissionSuffix:"pageQuery",treePermissionSuffix:"queryList",extPermission:o.queryPageExtPermission||null},{codeSuffix:"create",nameSuffix:"添加",permissionSuffix:"create",treePermissionSuffix:"queryList",extPermission:o.createExtPermission||null},{codeSuffix:"delete",nameSuffix:"删除",permissionSuffix:"delete",extPermission:o.deleteExtPermission||null},{codeSuffix:"update",nameSuffix:"修改",permissionSuffix:"update",treePermissionSuffix:"queryList",extPermission:o.updateExtPermission||null}],c=u([{field:{name:"items",value:m.map(e=>e.nameSuffix)},element:{comp:"PtCheckboxGroup",formItemProps:{label:"项目",required:!0},compProps:{dataMethod:()=>m,props:{value:"nameSuffix",label:"nameSuffix"},dataMethodResultHandle:S}}},{field:{name:"codePrefix"},element:{comp:"el-input",formItemProps:{label:"编码前缀",required:!0},compProps:{clearable:!0,placeholder:"如：user_manage_"}}},{field:{name:"namePrefix"},element:{comp:"el-input",formItemProps:{label:"名称前缀",required:!0},compProps:{clearable:!0,placeholder:"如：用户"}}},{field:{name:"permissionPrefix"},element:{comp:"el-input",formItemProps:{label:"权限码前缀",required:!0,tips:"注意一般结尾带冒号"},compProps:{clearable:!0,placeholder:"如：admin:web:user:"}}},{field:{name:"funcGroupId",value:""},element:{comp:"PtSelect",formItemProps:{label:"功能分组",required:!0},compProps:{clearable:!0,dataMethod:h}}},{field:{name:"icon",value:"Link"},element:{comp:"el-input",formItemProps:{label:"图标"},compProps:({form:e})=>{let t="Link";return g[e.icon]&&(t=e.icon),{clearable:!0,placeholder:"仅支持内置图标名称",prefixIcon:t}}}},{field:{name:"isDisabled",value:!1},element:{comp:"el-switch",formItemProps:{label:"是否禁用"},compProps:{activeText:"禁用",inactiveText:"启用"}}},{field:{name:"disabledReason"},element:{comp:"el-input",formItemProps:{label:"禁用原因",required:({form:e})=>e.isDisabled==!0},compProps:{clearable:!0}}},{field:{name:"isShow",value:!0},element:{comp:"el-switch",formItemProps:{label:"是否展示"},compProps:{activeText:"展示",inactiveText:"隐藏"}}},{field:{name:"parentId"},element:{comp:"PtCascader",formItemProps:{label:"父级",required:!0},compProps:{clearable:!0,dataMethod:()=>v({}),dataMethodResultHandleConvertToTree:!0}}},{field:{name:"typeDictId"},element:{comp:"PtDictFrontSelect",formItemProps:{label:"类型",required:!0},compProps:{clearable:!0,dictParam:{groupCode:"func_type"},defaultValueItem:e=>e.value=="button"}}},{field:{name:"url"},element:{comp:"el-input",formItemProps:{label:"路由",rules:[{validator:(e,t,a)=>{var r;!t&&((r=i.formData.typeDictId)==null?void 0:r.value)=="page"?a(new Error("路由不能为空")):a()},trigger:"blur"}],required:({formData:e})=>{var t;return((t=e.typeDictId)==null?void 0:t.value)=="page"}},compProps:{clearable:!0,placeholder:"如：/admin/user/add"}}},{field:{name:"seq",value:1e3},element:{comp:"el-input-number",formItemProps:{label:"排序"},compProps:{clearable:!0}}},{field:{name:"componentOf"},element:{comp:"el-input",formItemProps:{label:"归属组件",required:!0},compProps:{clearable:!0}}},{field:{name:"remark"},element:{comp:"el-input",formItemProps:{label:"描述"},compProps:{clearable:!0}}}]),d=u({buttonText:"确认添加",permission:"admin:web:func:create"}),l=e=>e?e+",":"",P=async e=>{let t=e.items;for(let a=0;a<t.length;a++){let r=_(e);try{delete r.items,delete r.codePrefix,delete r.namePrefix,delete r.permissionPrefix,Reflect.deleteProperty(r,"items"),Reflect.deleteProperty(r,"codePrefix"),Reflect.deleteProperty(r,"namePrefix"),Reflect.deleteProperty(r,"permissionPrefix")}catch{}let n=m.find(p=>p.nameSuffix==t[a]);r.code=e.codePrefix+n.codeSuffix,r.name=e.namePrefix+n.nameSuffix;let s="";o.isTree&&n.treePermissionSuffix&&(s=e.permissionPrefix+n.treePermissionSuffix),r.permissions=l(n.extPermission)+l(s)+(e.permissionPrefix+n.permissionSuffix),await M(r)}},x=()=>{o.parentId&&w({id:o.parentId}).then(e=>{let t=e.data.data;i.form.funcGroupId=t.funcGroupId,i.form.parentId=t.id,i.form.codePrefix=t.code+"_",i.form.namePrefix=t.name,i.form.componentOf=t.componentOf})},b=()=>"添加成功，请刷新数据查看";function S({success:e}){return e}return q(()=>{x()}),(e,t)=>{const a=D("PtForm");return T(),E(a,{form:i.form,formData:i.formData,labelWidth:"80",method:P,methodSuccess:b,defaultButtonsShow:"submit,reset",submitAttrs:d.value,buttonsTeleportProps:e.$route.meta.formButtonsTeleportProps,inline:"",layout:[1],comps:c.value},null,8,["form","formData","submitAttrs","buttonsTeleportProps","comps"])}}});export{R as default};
