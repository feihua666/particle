import{b as w}from"./toolsFrontApi-C6zzngok.js";import{d as E,a as B,r as u,b as C,o as D,c as y,e as i,F as M,O as R,B as V}from"./index-q46_oeYE.js";const U=E({__name:"BatchReplateSqlInsertIdsPage",setup(L){const{proxy:f}=V(),e=B({form:{},resultForm:{result:""},formData:{}}),d=u([{field:{name:"insertSql"},element:{comp:"el-input",formItemProps:{label:"sql插入语句",required:!0},compProps:{clearable:!0,type:"textarea",rows:10}}},{field:{name:"idExtractPattern",value:"VALUES \\(([^,]+),"},element:{comp:"el-input",formItemProps:{label:"id提取正则表达式",required:!0,tips:"经测试，默认的正则表达式支持datagrip和navicat复制的sql插入语句"},compProps:{clearable:!0}}},{field:{name:"valueSeparator",value:"="},element:{comp:"el-input",formItemProps:{label:"值分隔符",tips:"如果被替换的文本包括分隔符时，请填写其它分隔符",required:!0},compProps:{clearable:!0}}},{field:{name:"groupSeparator",value:";"},element:{comp:"el-input",formItemProps:{label:"组分隔符",tips:"如果被替换的文本包括分隔符时，请填写其它分隔符",required:!0},compProps:{clearable:!0}}},{field:{name:"replaceText",value:"VALUES (=;,="},element:{comp:"el-input",formItemProps:{label:"提取完成后替换",tips:"支持多组替换如：a=b,c=d将会把a替换成b，c替换成d"},compProps:{clearable:!0}}}]),b=u([{field:{name:"result"},element:{comp:"el-input",formItemProps:{label:"替换结果"},compProps:{clearable:!0,type:"textarea",rows:25}}}]),h=u({buttonText:"确认替换"}),I=()=>{n.value=[],c.value=0,e.resultForm.result="",P()},v=(r,t)=>{w({num:r}).then(l=>{for(let a=0;a<l.data.data.length;a++)n.value.push(l.data.data[a]);t()})},P=()=>{let r=e.form.insertSql.split(`
`),t=100,l=Math.ceil(r.length/t)+1;const a=m=>{m.forEach(s=>{if(!s||!s.trim())return;let p=R(e.form.idExtractPattern,s);if(p.length===0){x("没有匹配到内容");return}let A=g(p[0]),_=S();F(A,_)})},o=(m,s)=>{v(t,()=>{m-=1,m>0?o(m,s):s()})};o(l,()=>{a(r)})},n=u([]),c=u(0),S=()=>n.value[c.value++],g=r=>{let t="",l=e.form.replaceText;return l&&l.split(e.form.groupSeparator).forEach(a=>{let o=a.split(e.form.valueSeparator);t?t=t.replaceAll(o[0],o[1]):t=r.replaceAll(o[0],o[1])}),t},F=(r,t)=>{e.resultForm.result?e.resultForm.result=e.resultForm.result.replaceAll(r,t):e.resultForm.result=e.form.insertSql.replaceAll(r,t)},x=r=>{f.$message({showClose:!0,message:r,type:"error",showIcon:!0,grouping:!0})},q=()=>"替换成功";return(r,t)=>{const l=C("PtForm");return D(),y(M,null,[i(l,{form:e.form,formData:e.formData,labelWidth:"80",method:I,methodSuccess:q,defaultButtonsShow:"submit,reset",submitAttrs:h.value,layout:[1,3,1],comps:d.value},null,8,["form","formData","submitAttrs","comps"]),i(l,{form:e.resultForm,labelWidth:"80",defaultButtonsShow:"",layout:1,comps:b.value},null,8,["form","comps"])],64)}}});export{U as default};
