import{p as R,r as k}from"./userAdminApi-CSsHgdyh.js";import{d as I,u as M,r as w,l as g,a as A,b as i,o as B,c as F,e as a,w as p,f as O,F as C}from"./index-BAoWe_iC.js";import{p as D}from"./userManage-DVEn9JvD.js";import"./userCompItem-ByRBUqu9.js";import"./deptCompItem-B1A3OjYC.js";import"./deptTreeNameAdminApi-BLd6b1gx.js";const G=I({__name:"UserManagePage",setup(N){M();const f=w(null),x=[{prop:"nickname",label:"昵称",width:100,showOverflowTooltip:!0},{prop:"name",label:"姓名",showOverflowTooltip:!0},{prop:"avatar",label:"头像",columnView:"image",width:80},{prop:"serialNo",label:"编号",showOverflowTooltip:!0},{prop:"genderDictName",label:"性别",width:60},{prop:"isVirtual",label:"虚拟用户",width:80,formatter:(e,r,o,n)=>o?"虚拟用户":"真实用户"},{prop:"isLock",label:"是否锁定",width:80,formatter:(e,r,o,n)=>{let t=o?"锁定":"正常";return o&&e.lockReason&&(t=t+`(${e.lockReason})`),t},showOverflowTooltip:!0},{prop:"categoryDictName",label:"分类"},{prop:"groupFlag",label:"分组标识",showOverflowTooltip:!0},{prop:"sourceFromDictName",label:"来源",showOverflowTooltip:!0},{prop:"isExpired",label:"是否过期",width:80,formatter:(e,r,o,n)=>{let t=o?"已过期":"正常";return o&&e.expiredReason&&(t=t+`(${e.expiredReason})`),t}},{prop:"expireAt",label:"过期时间",showOverflowTooltip:!0},g("dept")?{prop:"deptName",label:"归属部门",showOverflowTooltip:!0}:null,{prop:"remark",label:"备注",showOverflowTooltip:!0}],s=A({form:{},formComps:D.filter(e=>!!e),tableColumns:x.filter(e=>!!e)}),l=w({buttonText:"查询",loading:!1,permission:"admin:web:user:pageQuery"}),b=()=>{f.value.refreshData()},h=({pageQuery:e})=>R({...s.form,...e}),P={permission:l.value.permission},_=({row:e,column:r,$index:o})=>{if(o<0)return[];let n={id:e.id},t={userId:e.id,nickname:e.nickname},u=[{txt:"编辑",text:!0,permission:"admin:web:user:update",route:{path:"/admin/userManageUpdate",query:t}},{txt:"删除",text:!0,position:"more",permission:"admin:web:user:delete",methodConfirmText:`删除用户将可能造成不可预知的后果，一般不建议删除，可以将用户锁定处理，如果是新用户可以放心删除。确定要删除 ${e.nickname} 吗？`,method(){return k(n).then(d=>(b(),Promise.resolve(d)))}},{txt:"重置密码",text:!0,position:"more",permission:"admin:web:userIdentifierPwd:user:resetPassword",methodConfirmText:"此操作会影响用户所有账号密码，确定要重置密码吗？",route:{path:"/admin/userPwdManageResetPassword",query:t}},{txt:"添加登录标识",text:!0,permission:"admin:web:userIdentifier:create",position:"more",route:{path:"/admin/userIdentifierManageAddFixed",query:t}},{txt:"绑定登录标识",text:!0,permission:"admin:web:userIdentifier:create",position:"more",route:{path:"/admin/userIdentifierManageBindFixed",query:t}},{txt:"登录标识",text:!0,permission:"admin:web:userIdentifier:pageQuery",position:"more",icon:"UserFilled",type:"primary",route:{path:"/admin/userIdentifierManagePage",query:t}},{txt:"用户密码",text:!0,permission:"admin:web:userIdentifierPwd:pageQuery",position:"more",icon:"View",type:"primary",route:{path:"/admin/userIdentifierPwdManagePage",query:t}}],m={userId:e.id,userNickname:e.nickname};return g("role")&&u.push({txt:"分配角色",text:!0,position:"more",permission:"admin:web:roleUserRel:userAssignRole",route:{path:"/admin/userManageUserAssignRole",query:m}}),u},v={text:!0,buttonText:"更多"};return(e,r)=>{const o=i("PtButton"),n=i("PtForm"),t=i("PtButtonGroup"),u=i("el-table-column"),m=i("PtTable"),d=i("PtRouteViewPopover");return B(),F(C,null,[a(n,{form:s.form,method:b,defaultButtonsShow:"submit,reset",submitAttrs:l.value,inline:"",comps:s.formComps},{buttons:p(()=>[a(o,{permission:"admin:web:user:create",route:"/admin/userManageAdd"},{default:p(()=>r[1]||(r[1]=[O("添加")])),_:1})]),_:1},8,["form","submitAttrs","comps"]),a(m,{ref_key:"tableRef",ref:f,dataMethod:h,onDataMethodDataLoading:r[0]||(r[0]=c=>l.value.loading=c),paginationProps:P,columns:s.tableColumns},{defaultAppend:p(()=>[a(u,{label:"操作",width:"180"},{default:p(({row:c,column:y,$index:T})=>[a(t,{options:_({row:c,column:y,$index:T}),dropdownTriggerButtonOptions:v},null,8,["options"])]),_:1})]),_:1},8,["columns"]),a(d,{level:3})],64)}}});export{G as default};
