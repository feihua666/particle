import{l as h,m as o,h as m,n as v}from"./dataQueryDatasourceApiManage-D7a51JbH.js";import{d as S,r as p,a as T,S as C,b as c,o as q,c as A,e as d,F as D,E as I}from"./index-DoSQKVHz.js";import"./dataQueryDatasourceAdminApi-D7kO4g4U.js";import"./dataqueryProviderCompItem-CG_2SCsK.js";import"./dataQueryProviderAdminApi-BdKPZMyj.js";const Q=S({__name:"DataQueryDatasourceApiManageTestPage",props:{dataQueryDatasourceApiId:{type:String,required:!0}},setup(f){let u=(t,e="success")=>{I({showClose:!0,message:t,type:e,showIcon:!0,grouping:!0})};const i=f,s=p(""),n=T({form:{param:""},formComps:[{field:{name:"name",valueChange({form:t,formData:e}){C(()=>{e.name&&(s.value==="queryString"?t.queryString=e.name.content:t.param=e.name.content)})}},element:{comp:"PtSelect",formItemProps:{label:"用例名称",tips:"选择一个用例数据作为参数，默认选中第一个"},compProps:{clearable:!0,defaultValueItem:t=>!0,props:{value:"name"},dataMethod:()=>h({id:i.dataQueryDatasourceApiId}).then(t=>{let e=t.data.data;s.value=e.inParamTypeDictValue;let r=[];return e.inParamTestCaseDataConfigJson&&(r=JSON.parse(e.inParamTestCaseDataConfigJson).inParamTestCases,console.log(r)),Promise.resolve(r)})}}},{field:{name:"param"},element:{comp:"el-input",formItemProps:{label:"参数",displayBlock:!0},compProps:{type:"textarea",rows:15}}},{field:{name:"queryString"},element:{comp:"el-input",formItemProps:{label:"查询字符串",displayBlock:!0},compProps:{clearable:!0,placeholder:"仅http支持"}}}],testResult:{value:""}}),y=p({buttonText:"查询",permission:"admin:web:dataQueryDatasourceApi:test",beforeMethod:()=>{let t=n.form.param,e=n.form.queryString;if(s.value){if(!t&&!e){u("接口需要请求参数，请填写","error");return}try{e&&o.queryString(e)}catch{u("数据查询参数格式错误，接口定义的入参类型和输入参数转换错误，请检查！","error");return}try{t&&s.value!="queryString"&&o[s.value](t)}catch{u("参数格式错误，接口定义的入参类型和输入参数转换错误，请检查！","error");return}}return!0}}),g=t=>{let e=t.param,r=t.queryString,a={dataQueryDatasourceApiId:i.dataQueryDatasourceApiId,param:null,queryString:r||null};if(s.value)if(s.value!="queryString")a.param=o[s.value](e);else{try{a.param=o[m.object](e)}catch{}if(!a.param)try{a.param=o[m.array](e)}catch{}if(!a.param)try{a.param=o[m.float](e)}catch{}if(!a.param)try{a.param=o[m.number](e)}catch{}if(!a.param)try{a.param=o[m.boolean](e)}catch{}if(!(a.param===!0||a.param===!1))try{a.param=o[m.string](e)}catch{}}return v(a)},P=t=>{let e=t.data;return n.testResult.value=JSON.stringify(e,null,"   "),"数据查询成功"},b=()=>{n.testResult.value=""};return(t,e)=>{const r=c("PtForm"),a=c("PtAceEditor");return q(),A(D,null,[d(r,{form:n.form,method:g,methodSuccess:P,defaultButtonsShow:"submit,reset",submitAttrs:y.value,labelWidth:"100",buttonsTeleportProps:t.$route.meta.formButtonsTeleportProps,onResetForm:b,inline:"",layout:1,comps:n.formComps},null,8,["form","submitAttrs","buttonsTeleportProps","comps"]),d(a,{modelValue:n.testResult.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.testResult.value=l),mode:"ace/mode/json",class:"pt-width-100-pc"},null,8,["modelValue"])],64)}}});export{Q as default};
