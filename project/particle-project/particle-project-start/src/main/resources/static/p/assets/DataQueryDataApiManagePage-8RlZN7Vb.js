import{r as Q,p as C,a as M,d as _,b as w,c as R,e as O,f as B}from"./dataQueryDataApiAdminApi-DP2Imj9n.js";import{p as N}from"./dataQueryDataApiManage-CtBTTVar.js";import{d as S,r as b,a as V,b as n,o as F,c as $,e as s,w as p,f,ae as k,af as q,F as E}from"./index-DY8PGGNe.js";import"./dataQueryDatasourceApiManage-T7gzNYAM.js";import"./dataQueryDatasourceAdminApi-BTtrujFf.js";import"./dataqueryProviderCompItem-Duf0wlR_.js";import"./dataQueryProviderAdminApi-D01fZhWA.js";const J=S({__name:"DataQueryDataApiManagePage",props:{url:{type:String}},setup(h){const c=b(null),o=V({form:{url:h.url||null},formComps:N,tableColumns:[{prop:"url",label:"接口地址",showOverflowTooltip:!0},{prop:"name",label:"接口名称",showOverflowTooltip:!0},{prop:"dataQueryDatasourceApiName",label:"直连数据源接口",showOverflowTooltip:!0},{prop:"adaptTypeDictName",label:"适配类型"},{prop:"inParamTypeDictName",label:"入参类型"},{prop:"outParamTypeDictName",label:"出参类型"},{prop:"responseTypeDictName",label:"输出类型",showOverflowTooltip:!0},{prop:"isPublished",label:"是否发布",formatter:(e,r,a,i)=>a?"已发布":"未发布"},{prop:"isMaster",label:"配置分支",formatter:(e,r,a,i)=>a?"master":"dev"},{prop:"isTestPassed",label:"是否测试通过",formatter:(e,r,a,i)=>a?"测试通过":"未测试通过"},{prop:"dataQueryProviderName",label:"数据查询供应商",showOverflowTooltip:!0},{prop:"apiIdentifier",label:"接口标识",showOverflowTooltip:!0},{prop:"apiVersion",label:"接口版本标识",showOverflowTooltip:!0},{prop:"isSupportWarehouse",label:"支持入库",formatter:(e,r,a,i)=>a?"支持":"不支持"},{prop:"remark",label:"描述",showOverflowTooltip:!0}]}),u=b({buttonText:"查询",loading:!1,permission:"admin:web:dataQueryDataApi:pageQuery"}),v={permission:"admin:web:dataQueryDataApi:refreshOpenapiExecuteProviderCache",methodSuccess:e=>"刷新缓存成功,如果部署多个实例可能要多次执行。 "+e.data.data,method(){return Q().then(e=>Promise.resolve(e))}},d=()=>{c.value.refreshData()},y=({pageQuery:e})=>C({...o.form,...e}),x={permission:u.value.permission},D=({row:e,column:r,$index:a})=>{if(a<0)return[];let i={id:e.id},m=[{txt:"接口测试",text:!0,permission:"admin:web:dataQueryDataApi:test",route:{path:"/admin/DataQueryDataApiManageTest",query:i}},{txt:"编辑",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"已发布不能编辑，可以通过复制dev来修改提交":void 0,position:"more",permission:"admin:web:dataQueryDataApi:update",route:{path:"/admin/DataQueryDataApiManageUpdate",query:i}},{txt:"删除",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"已发布不能删除":void 0,position:"more",permission:"admin:web:dataQueryDataApi:delete",methodConfirmText:`确定要删除 ${e.name} 吗？`,method(){return M({id:e.id}).then(t=>(d(),Promise.resolve(t)))}},{txt:"删除缓存",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:deleteCache",methodConfirmText:`确定要删除 ${e.name} 缓存吗？如果部署多个实例可能要多次执行`,methodSuccess:t=>"删除缓存成功 "+t.data.data,method(){return _({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"刷新缓存",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:refreshCache",methodSuccess:t=>"刷新缓存成功,如果部署多个实例可能要多次执行。 "+t.data.data,method(){return w({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"复制",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"仅支持master复制",position:"more",permission:"admin:web:dataQueryDataApi:copy",methodConfirmText:`确定要复制 ${e.name} 吗？`,methodSuccess:t=>{o.form.name=t.data.data.name,d()},method(){return R({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"复制dev",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"仅支持master复制",position:"more",permission:"admin:web:dataQueryDataApi:copydev",methodConfirmText:`确定要复制 ${e.name} 吗？复制后可以修改并提交到主分支`,methodSuccess:t=>{o.form.name=t.data.data.name,d()},method(){return O({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"查看",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:detail",route:{path:"/admin/DataQueryDataApiManageView",query:i}}];return e.isMaster||m.push({txt:"提交至master",text:!0,disabled:e.isMaster,disabledReason:e.isMaster?"仅支持dev":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:devMergeToMaster",methodConfirmText:`确定要将 ${e.name} 提交至master吗？提交成功后本数据将会被删除！`,methodSuccess:t=>{t.data.data.name?o.form.name=t.data.data.name:o.form.name?o.form.name=o.form.name.replace("Copydev",""):o.form.name=e.name.replace("Copydev",""),d()},method(){return B({id:e.id}).then(t=>Promise.resolve(t))}}),e.adaptTypeDictValue=="single_direct"&&m.push({txt:"查看数据源接口",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:pageQuery",route:{path:"/admin/dataQueryDatasourceApiManagePage",query:{dataQueryDatasourceApiName:e.dataQueryDatasourceApiName}}}),m};return(e,r)=>{const a=n("PtButton"),i=n("PtForm"),m=n("PtButtonGroup"),t=n("el-table-column"),P=n("PtTable"),T=n("PtRouteViewPopover");return F(),$(E,null,[s(i,{form:o.form,method:d,defaultButtonsShow:"submit,reset",submitAttrs:u.value,inline:"",labelWidth:"120",comps:o.formComps},{buttons:p(()=>[s(a,{permission:"admin:web:dataQueryDataApi:create",route:"/admin/DataQueryDataApiManageAdd"},{default:p(()=>r[1]||(r[1]=[f("添加")])),_:1}),s(a,k(q(v)),{default:p(()=>r[2]||(r[2]=[f("刷新执行器供应商缓存")])),_:1},16)]),_:1},8,["form","submitAttrs","comps"]),s(P,{ref_key:"tableRef",ref:c,"default-expand-all":"",dataMethod:y,onDataMethodDataLoading:r[0]||(r[0]=l=>u.value.loading=l),dataMethodResultHandleConvertToTree:!0,paginationProps:x,columns:o.tableColumns},{defaultAppend:p(()=>[s(t,{label:"操作",width:"220"},{default:p(({row:l,column:A,$index:g})=>[s(m,{options:D({row:l,column:A,$index:g}),dropdownTriggerButtonOptions:{text:!0,buttonText:"更多"}},null,8,["options"])]),_:1})]),_:1},8,["columns"]),s(T,{level:3})],64)}}});export{J as default};
