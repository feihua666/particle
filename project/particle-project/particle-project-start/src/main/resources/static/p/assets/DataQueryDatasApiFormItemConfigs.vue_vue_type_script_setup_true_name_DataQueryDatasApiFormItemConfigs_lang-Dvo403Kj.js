import{o as B}from"./dataQueryDatasourceApiManage-BbHkQ5DP.js";import{d as _,r as g,a as J,S as v,$ as D,b as d,o as y,c as I,e as l,w as m,F as V,g as x,j as P,f as M,I as h}from"./index-BIT85eDf.js";const F=_({__name:"AdaptMultipleAggregationConfig",props:{initJsonStr:{type:String}},setup(p,{expose:C}){const r=g(null),i=p,t=J({initJson:{aggregationItems:[]},form:{datasourceApiName:""},formComps:[{field:{name:"outputKey"},element:{comp:"el-input",formItemProps:{label:"聚合变量",required:!0,tips:"将以该变量做为输出对象的key"},compProps:{clearable:!0}}},{field:{name:"dataQueryDatasourceApiId",valueChange({form:e,formData:n}){v(()=>{var s;n.dataQueryDatasourceApiId&&(e.datasourceApiName=(s=n.dataQueryDatasourceApiId)==null?void 0:s.name)})}},element:{comp:"PtSelect",formItemProps:{label:"数据查询数据源接口",required:!0},compProps:{dataMethod:B}}}],tableColumns:[{prop:"outputKey",label:"聚合变量"},{prop:"datasourceApiName",label:"数据查询数据源接口"}]});D(()=>{i.initJsonStr&&(t.initJson=JSON.parse(i.initJsonStr))});const a=g({buttonText:"添加示例"}),f=()=>{let e={outputKey:t.form.outputKey,dataQueryDatasourceApiId:t.form.dataQueryDatasourceApiId,datasourceApiName:t.form.datasourceApiName};t.initJson.aggregationItems.push(e)},u=({row:e,column:n,$index:s})=>s<0?[]:[{txt:"删除",text:!0,methodConfirmText:`确定要删除 ${e.name} 吗？`,method(){t.initJson.aggregationItems.splice(s,1)}}];return C({getInitJson:()=>t.initJson}),(e,n)=>{const s=d("PtForm"),b=d("PtButtonGroup"),o=d("el-table-column"),A=d("PtTable");return y(),I(V,null,[l(s,{form:t.form,formData:t.formData,class:"pt-wdith-100-pc",method:f,defaultButtonsShow:"submit,reset",submitAttrs:a.value,layout:1,comps:t.formComps},null,8,["form","formData","submitAttrs","comps"]),l(A,{ref_key:"tableRef",ref:r,options:t.initJson.aggregationItems,columns:t.tableColumns},{defaultAppend:m(()=>[l(o,{label:"操作",width:"180"},{default:m(({row:S,column:c,$index:w})=>[l(b,{options:u({row:S,column:c,$index:w})},null,8,["options"])]),_:1})]),_:1},8,["options","columns"])],64)}}}),N=_({__name:"AdaptCustomScriptConfig",props:{initJsonStr:{type:String},onSubmit:{type:Function,default:()=>({})}},setup(p,{expose:C}){const r=p,i=J({form:{}}),t=[{field:{name:"customScriptType"},element:{comp:"PtDictFrontSelect",formItemProps:{label:"脚本类型",required:!0},compProps:{dictParam:{groupCode:"dataquery_data_api_custom_script_type"},props:{value:"value"}}}},{field:{name:"scriptTemplate"},element:{comp:"el-input",formItemProps:{label:"脚本内容",required:!0,tips:'groovy示例：def map = new HashMap();map.put("result1",datasourceApi.invoke("datasourceApiCode",data,queryStr));map; 以上为接口聚合示例，其中 datasourceApi 包括三个参数 参数1=数据查询数据源接口编码，2=请求参数，data变量为请求参数句柄,3=查询字符串参数，最后 map 需要返回处理结果,支持使用dataQueryDataApiExecutor句柄引用线程池加速处理'},compProps:{type:"textarea",rows:15,clearable:!0}}}];D(()=>{if(r.initJsonStr){let u=JSON.parse(r.initJsonStr);for(let e in u)i.form[e]=u[e]}});const a=g({buttonText:"确认"}),f=()=>{r.onSubmit()};return C({form:i.form}),(u,e)=>{const n=d("PtForm");return y(),x(n,{ref:"selfFormRef",form:i.form,class:"pt-wdith-100-pc",method:f,defaultButtonsShow:"submit,reset",submitAttrs:a.value,layout:1,comps:t},null,8,["form","submitAttrs"])}}}),T=_({__name:"DataQueryDatasApiFormItemConfigs",props:{form:{type:Object,required:!0},formData:{type:Object,required:!0}},setup(p,{expose:C}){const r=g(null),i=g(null),t=p,a=J({adaptMultipleAggregationConfigJson:{dialogVisible:!1},adaptCustomScriptConfig:{dialogVisible:!1}}),f=b=>JSON.stringify(b),u=()=>{r.value.getInitJson().aggregationItems.length>0?t.form.adaptConfigJson=f(r.value.getInitJson()):t.form.adaptConfigJson="",a.adaptMultipleAggregationConfigJson.dialogVisible=!1},e=()=>{t.form.adaptConfigJson=f(i.value.form),a.adaptCustomScriptConfig.dialogVisible=!1},n=g(!1),s=()=>{v(()=>{n.value=!0})};return C({reactiveData:a}),(b,o)=>{const A=d("PtButton"),S=d("el-dialog");return y(),I(V,null,[l(S,{modelValue:a.adaptMultipleAggregationConfigJson.dialogVisible,"onUpdate:modelValue":o[0]||(o[0]=c=>a.adaptMultipleAggregationConfigJson.dialogVisible=c),width:"70%",title:"多接口聚合配置Json","append-to-body":"","destroy-on-close":""},{footer:m(()=>[P("span",null,[l(A,{type:"primary",onClick:u},{default:m(()=>o[3]||(o[3]=[M("确认")])),_:1})])]),default:m(()=>[l(F,{ref_key:"adaptMultipleAggregationConfigRef",ref:r,initJsonStr:p.form.adaptConfigJson},null,8,["initJsonStr"])]),_:1},8,["modelValue"]),l(S,{modelValue:a.adaptCustomScriptConfig.dialogVisible,"onUpdate:modelValue":o[1]||(o[1]=c=>a.adaptCustomScriptConfig.dialogVisible=c),width:"70%",title:"自定义脚本配置Json",onOpen:s,onClosed:o[2]||(o[2]=c=>n.value=!1),"append-to-body":"","destroy-on-close":""},{footer:m(()=>o[4]||(o[4]=[P("div",{id:"dataqueryDatasourceApiAdaptCustomScriptConfigDialogFooter"},null,-1)])),default:m(()=>[n.value?(y(),x(N,{key:0,ref_key:"adaptCustomScriptConfigConfigRef",ref:i,initJsonStr:p.form.adaptConfigJson,onSubmit:e,buttonsTeleportProps:{disabled:!1,to:"#dataqueryDatasourceApiAdaptCustomScriptConfigDialogFooter"}},null,8,["initJsonStr"])):h("",!0)]),_:1},8,["modelValue"])],64)}}});export{T as _};
