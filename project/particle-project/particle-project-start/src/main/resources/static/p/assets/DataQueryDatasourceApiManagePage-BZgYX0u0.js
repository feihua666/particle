import{p as g,a as A,r as Q,d as _,b as M,c as C,e as w,f as R}from"./dataQueryDatasourceApiManage-Bk3_25VH.js";import{d as B,r as b,a as S,b as i,o as O,c as k,e as n,w as u,f as F,F as N}from"./index-COCB7OXO.js";import"./dataQueryDatasourceAdminApi-uWqxzemP.js";import"./dataqueryProviderCompItem-mdBVEThF.js";import"./dataQueryProviderAdminApi-wrhfma_g.js";const E=B({__name:"DataQueryDatasourceApiManagePage",props:{name:{type:String}},setup(f){const c=b(null),a=S({form:{name:f.name},formComps:g,tableColumns:[{prop:"code",label:"编码",showOverflowTooltip:!0},{prop:"name",label:"名称",showOverflowTooltip:!0},{prop:"categoryDictName",label:"分类"},{prop:"dataQueryProviderName",label:"数据查询供应商"},{prop:"dataQueryProviderDocLinkUrl",label:"文档链接",showOverflowTooltip:!0},{prop:"dataQueryDatasourceName",label:"数据查询数据源",showOverflowTooltip:!0},{prop:"readTimeout",label:"读取等待时间(ms)"},{prop:"connectTimeout",label:"连接等待时间(ms)"},{prop:"sameTag",label:"等同标签"},{prop:"isSupportTrans",label:"翻译支持",formatter:(e,r,o,s)=>o?"支持":"不支持"},{prop:"isPublished",label:"是否发布",formatter:(e,r,o,s)=>o?"已发布":"未发布"},{prop:"isMaster",label:"配置分支",formatter:(e,r,o,s)=>o?"master":"dev"},{prop:"isTestPassed",label:"是否测试通过",formatter:(e,r,o,s)=>o?"测试通过":"未测试通过"},{prop:"remark",label:"描述",showOverflowTooltip:!0}]}),p=b({buttonText:"查询",loading:!1,permission:"admin:web:dataQueryDatasourceApi:pageQuery"}),m=()=>{c.value.refreshData()},h=({pageQuery:e})=>A({...a.form,...e}),v={permission:p.value.permission},x=({row:e,column:r,$index:o})=>{if(o<0)return[];let s={id:e.id},d=[{txt:"接口测试",text:!0,permission:"admin:web:dataQueryDatasourceApi:test",route:{path:"/admin/DataQueryDatasourceApiManageTest",query:s}},{txt:"编辑",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"已发布不能编辑，可以通过复制dev来修改提交":void 0,permission:"admin:web:dataQueryDatasourceApi:update",position:"more",route:{path:"/admin/DataQueryDatasourceApiManageUpdate",query:s}},{txt:"删除",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"已发布不能删除":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:delete",methodConfirmText:`可能存在数据查询引用（包括直连引用或通过编码脚本调用）请确保安全，确定要删除 ${e.name} 吗？`,method(){return Q({id:e.id}).then(t=>(m(),Promise.resolve(t)))}},{txt:"删除缓存",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:deleteCache",methodConfirmText:`确定要删除 ${e.name} 缓存吗？如果部署多个实例可能要多次执行`,methodSuccess:t=>"删除缓存成功 "+t.data.data,method(){return _({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"刷新缓存",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:refreshCache",methodSuccess:t=>"刷新缓存成功，如果部署多个实例可能要多次执行。 "+t.data.data,method(){return M({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"复制",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"仅支持master复制",position:"more",permission:"admin:web:dataQueryDatasourceApi:copy",methodConfirmText:`确定要复制 ${e.name} 吗？`,methodSuccess:t=>{a.form.name=t.data.data.name,m()},method(){return C({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"复制dev",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"仅支持master复制",position:"more",permission:"admin:web:dataQueryDatasourceApi:copydev",methodConfirmText:`确定要复制 ${e.name} 吗？复制后可以修改并提交到主分支`,methodSuccess:t=>{a.form.name=t.data.data.name,m()},method(){return w({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"查看",text:!0,permission:"admin:web:dataQueryDatasourceApi:detail",position:"more",route:{path:"/admin/DataQueryDatasourceApiManageView",query:s}}];return e.isMaster||d.push({txt:"提交至master",text:!0,disabled:e.isMaster,disabledReason:e.isMaster?"仅支持dev":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:devMergeToMaster",methodConfirmText:`确定要将 ${e.name} 提交至master吗？提交成功后本数据将会被删除！`,methodSuccess:t=>{t.data.data.name?a.form.name=t.data.data.name:a.form.name?a.form.name=a.form.name.replace("Copydev",""):a.form.name=e.name.replace("Copydev",""),m()},method(){return R({id:e.id}).then(t=>Promise.resolve(t))}}),d};return(e,r)=>{const o=i("PtButton"),s=i("PtForm"),d=i("PtButtonGroup"),t=i("el-table-column"),y=i("PtTable"),D=i("PtRouteViewPopover");return O(),k(N,null,[n(s,{form:a.form,method:m,defaultButtonsShow:"submit,reset",submitAttrs:p.value,labelWidth:"120",inline:"",comps:a.formComps},{buttons:u(()=>[n(o,{permission:"admin:web:dataQueryDatasourceApi:create",route:"/admin/DataQueryDatasourceApiManageAdd"},{default:u(()=>r[1]||(r[1]=[F("添加")])),_:1})]),_:1},8,["form","submitAttrs","comps"]),n(y,{ref_key:"tableRef",ref:c,"default-expand-all":"",dataMethod:h,onDataMethodDataLoading:r[0]||(r[0]=l=>p.value.loading=l),paginationProps:v,columns:a.tableColumns},{defaultAppend:u(()=>[n(t,{label:"操作",width:"220"},{default:u(({row:l,column:P,$index:T})=>[n(d,{options:x({row:l,column:P,$index:T}),dropdownTriggerButtonOptions:{text:!0,buttonText:"更多"}},null,8,["options"])]),_:1})]),_:1},8,["columns"]),n(D,{level:3})],64)}}});export{E as default};
