import{a as I,b as w}from"./dynamicTableAdminApi-BJev9B-p.js";import{l as B}from"./dynamicTableFieldAdminApi-lVbKTqUU.js";import{d as D,r as p,a as v,b as r,o as f,c as x,e as c,g as F,w as h,I as k,F as R}from"./index-BIT85eDf.js";const E=D({__name:"DynamicTableManageDataPage",props:{dynamicTableId:{type:String},batchId:{type:String}},setup(_){const u=p(null),n=_,e=v({form:{dynamicTableId:n.dynamicTableId,batchId:n.batchId},formComps:[{field:{name:"isPublic"},element:{comp:"PtSelect",formItemProps:{label:"是否发布"},compProps:{dataMethod:()=>({data:[{id:"true",name:"已发布"},{id:"false",name:"未发布"}]})}}}],tableColumns:[],tableFieldLoaded:!1});(t=>{B({dynamicTableId:t}).then(o=>{o.data.data.forEach(a=>{e.tableColumns.push({prop:a.name,label:a.comment})}),e.tableColumns.push({prop:"is_public",label:"是否发布",formatter:(a,s,i,m)=>i?"已发布":"未发布"}),e.tableColumns.push({prop:"create_by_nickname",label:"创建人昵称"}),e.tableFieldLoaded=!0})})(n.dynamicTableId);const d=p({buttonText:"查询",loading:!1,permission:"admin:web:dynamicTable:dataPageQuery"}),b=()=>{u.value.refreshData()},y=({pageQuery:t})=>I({...e.form,...t}),P={permission:d.value.permission},T=({row:t,column:o,$index:l})=>l<0?[]:(t.id,[{txt:"删除",text:!0,permission:"admin:web:dynamicTable:dataDelete",methodConfirmText:"确定要删除当前数据吗？",method(){return w({id:t.id,dynamicTableId:n.dynamicTableId}).then(s=>(b(),Promise.resolve(s)))}}]);return(t,o)=>{const l=r("PtForm"),a=r("PtButtonGroup"),s=r("el-table-column"),i=r("PtTable");return f(),x(R,null,[c(l,{form:e.form,method:b,defaultButtonsShow:"submit",submitAttrs:d.value,showButtonItem:!0,inline:"",comps:e.formComps},null,8,["form","submitAttrs","comps"]),e.tableFieldLoaded?(f(),F(i,{key:0,ref_key:"tableRef",ref:u,"default-expand-all":"",dataMethod:y,onDataMethodDataLoading:o[0]||(o[0]=m=>d.value.loading=m),paginationProps:P,columns:e.tableColumns},{defaultAppend:h(()=>[c(s,{label:"操作",width:"180"},{default:h(({row:m,column:g,$index:C})=>[c(a,{options:T({row:m,column:g,$index:C})},null,8,["options"])]),_:1})]),_:1},8,["columns"])):k("",!0)],64)}}});export{E as default};
