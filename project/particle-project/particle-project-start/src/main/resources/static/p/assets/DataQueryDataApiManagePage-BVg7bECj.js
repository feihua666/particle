import{r as Q,p as C,a as M,d as _,b as R,c as B,e as w,f as N}from"./dataQueryDataApiAdminApi-C_DqAkBr.js";import{p as O}from"./dataQueryDataApiManage-CS0Dcqck.js";import{d as S,r as b,a as V,b as n,o as F,c as $,e as s,w as p,f,ae as k,af as q,F as E}from"./index-COCB7OXO.js";import"./dataQueryDatasourceApiManage-Bk3_25VH.js";import"./dataQueryDatasourceAdminApi-uWqxzemP.js";import"./dataqueryProviderCompItem-mdBVEThF.js";import"./dataQueryProviderAdminApi-wrhfma_g.js";const J=S({__name:"DataQueryDataApiManagePage",props:{url:{type:String}},setup(h){const c=b(null),a=V({form:{url:h.url||null},formComps:O,tableColumns:[{prop:"url",label:"接口地址",showOverflowTooltip:!0},{prop:"name",label:"接口名称",showOverflowTooltip:!0},{prop:"dataQueryDatasourceApiName",label:"直连数据源接口",showOverflowTooltip:!0},{prop:"adaptTypeDictName",label:"适配类型"},{prop:"inParamTypeDictName",label:"入参类型"},{prop:"outParamTypeDictName",label:"出参类型"},{prop:"responseTypeDictName",label:"输出类型"},{prop:"isPublished",label:"是否发布",formatter:(e,o,r,i)=>r?"已发布":"未发布"},{prop:"isMaster",label:"配置分支",formatter:(e,o,r,i)=>r?"master":"dev"},{prop:"isTestPassed",label:"是否测试通过",formatter:(e,o,r,i)=>r?"测试通过":"未测试通过"},{prop:"remark",label:"描述",showOverflowTooltip:!0}]}),u=b({buttonText:"查询",loading:!1,permission:"admin:web:dataQueryDataApi:pageQuery"}),v={permission:"admin:web:dataQueryDataApi:refreshOpenapiExecuteProviderCache",methodSuccess:e=>"刷新缓存成功,如果部署多个实例可能要多次执行。 "+e.data.data,method(){return Q().then(e=>Promise.resolve(e))}},d=()=>{c.value.refreshData()},y=({pageQuery:e})=>C({...a.form,...e}),x={permission:u.value.permission},D=({row:e,column:o,$index:r})=>{if(r<0)return[];let i={id:e.id},m=[{txt:"接口测试",text:!0,permission:"admin:web:dataQueryDataApi:test",route:{path:"/admin/DataQueryDataApiManageTest",query:i}},{txt:"编辑",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"已发布不能编辑，可以通过复制dev来修改提交":void 0,position:"more",permission:"admin:web:dataQueryDataApi:update",route:{path:"/admin/DataQueryDataApiManageUpdate",query:i}},{txt:"删除",text:!0,disabled:e.isPublished,disabledReason:e.isPublished?"已发布不能删除":void 0,position:"more",permission:"admin:web:dataQueryDataApi:delete",methodConfirmText:`确定要删除 ${e.name} 吗？`,method(){return M({id:e.id}).then(t=>(d(),Promise.resolve(t)))}},{txt:"删除缓存",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:deleteCache",methodConfirmText:`确定要删除 ${e.name} 缓存吗？如果部署多个实例可能要多次执行`,methodSuccess:t=>"删除缓存成功 "+t.data.data,method(){return _({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"刷新缓存",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:refreshCache",methodSuccess:t=>"刷新缓存成功,如果部署多个实例可能要多次执行。 "+t.data.data,method(){return R({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"复制",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"仅支持master复制",position:"more",permission:"admin:web:dataQueryDataApi:copy",methodConfirmText:`确定要复制 ${e.name} 吗？`,methodSuccess:t=>{a.form.name=t.data.data.name,d()},method(){return B({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"复制dev",text:!0,disabled:!e.isMaster,disabledReason:e.isMaster?void 0:"仅支持master复制",position:"more",permission:"admin:web:dataQueryDataApi:copydev",methodConfirmText:`确定要复制 ${e.name} 吗？复制后可以修改并提交到主分支`,methodSuccess:t=>{a.form.name=t.data.data.name,d()},method(){return w({id:e.id}).then(t=>Promise.resolve(t))}},{txt:"查看",text:!0,position:"more",permission:"admin:web:dataQueryDataApi:detail",route:{path:"/admin/DataQueryDataApiManageView",query:i}}];return e.isMaster||m.push({txt:"提交至master",text:!0,disabled:e.isMaster,disabledReason:e.isMaster?"仅支持dev":void 0,position:"more",permission:"admin:web:dataQueryDatasourceApi:devMergeToMaster",methodConfirmText:`确定要将 ${e.name} 提交至master吗？提交成功后本数据将会被删除！`,methodSuccess:t=>{t.data.data.name?a.form.name=t.data.data.name:a.form.name?a.form.name=a.form.name.replace("Copydev",""):a.form.name=e.name.replace("Copydev",""),d()},method(){return N({id:e.id}).then(t=>Promise.resolve(t))}}),e.adaptTypeDictValue=="single_direct"&&m.push({txt:"查看数据源接口",text:!0,position:"more",permission:"admin:web:dataQueryDatasourceApi:pageQuery",route:{path:"/admin/dataQueryDatasourceApiManagePage",query:{dataQueryDatasourceApiName:e.dataQueryDatasourceApiName}}}),m};return(e,o)=>{const r=n("PtButton"),i=n("PtForm"),m=n("PtButtonGroup"),t=n("el-table-column"),P=n("PtTable"),A=n("PtRouteViewPopover");return F(),$(E,null,[s(i,{form:a.form,method:d,defaultButtonsShow:"submit,reset",submitAttrs:u.value,inline:"",labelWidth:"120",comps:a.formComps},{buttons:p(()=>[s(r,{permission:"admin:web:dataQueryDataApi:create",route:"/admin/DataQueryDataApiManageAdd"},{default:p(()=>o[1]||(o[1]=[f("添加")])),_:1}),s(r,k(q(v)),{default:p(()=>o[2]||(o[2]=[f("刷新执行器供应商缓存")])),_:1},16)]),_:1},8,["form","submitAttrs","comps"]),s(P,{ref_key:"tableRef",ref:c,"default-expand-all":"",dataMethod:y,onDataMethodDataLoading:o[0]||(o[0]=l=>u.value.loading=l),dataMethodResultHandleConvertToTree:!0,paginationProps:x,columns:a.tableColumns},{defaultAppend:p(()=>[s(t,{label:"操作",width:"220"},{default:p(({row:l,column:g,$index:T})=>[s(m,{options:D({row:l,column:g,$index:T}),dropdownTriggerButtonOptions:{text:!0,buttonText:"更多"}},null,8,["options"])]),_:1})]),_:1},8,["columns"]),s(A,{level:3})],64)}}});export{J as default};
