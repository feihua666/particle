import{p as h,r as w,e as D}from"./dynamicTableAdminApi-BJev9B-p.js";import{p as v}from"./dynamicTableManage-D7xdLLR4.js";import{e as B,a as C,d as F}from"./FileTools-Cx4MUywI.js";import{d as M,r as T,a as R,b as o,o as A,c as N,e as n,w as l,f as I,F as V}from"./index-BIT85eDf.js";const $=M({__name:"DynamicTableManagePage",setup(k){const c=T(null),i=R({form:{},formComps:v,tableColumns:[{prop:"name",label:"表名称"},{prop:"dynamicTableFieldNum",label:"字段数量"},{prop:"dynamicTableDataNum",label:"数据数量"},{prop:"comment",label:"表注释"}]}),s=T({buttonText:"查询",loading:!1,permission:"admin:web:dynamicTable:pageQuery"}),b=()=>{c.value.refreshData()},x=({pageQuery:e})=>h({...i.form,...e}),y={permission:s.value.permission},_=({row:e,column:m,$index:p})=>{if(p<0)return[];let r={id:e.id};return[{txt:"数据管理",text:!0,permission:"admin:web:dynamicTable:dataPageQuery",route:{path:"/admin/dynamicTableManageData",query:r}},{txt:"编辑",text:!0,position:"more",permission:"admin:web:dynamicTable:update",route:{path:"/admin/DynamicTableManageUpdate",query:r}},{txt:"删除",text:!0,position:"more",permission:"admin:web:dynamicTable:delete",methodConfirmText:`确定要删除 ${e.name} 吗？将级联删除关联的字段信息，删除后数据（包括导入的数据）无法恢复，请谨慎操作！`,method(){return w({id:e.id}).then(t=>(b(),Promise.resolve(t)))}},{txt:"导出动态数据模板",text:!0,position:"more",permission:"admin:web:dynamicTable:exportTemplate",methodConfirmText:`确定要导出动态数据模板 ${e.name} 吗？`,method(){return D({id:e.id}).then(t=>{let d=t.data,u=B(t),a=C(t);return a=decodeURIComponent(a),F(d,u,a),Promise.resolve(t)})}},{txt:"导入数据",text:!0,position:"more",permission:"admin:web:dynamicTable:uploadImportData",route:{path:"/admin/dynamicTableManageImportData",query:r}}]};return(e,m)=>{const p=o("PtButton"),r=o("PtForm"),f=o("PtButtonGroup"),t=o("el-table-column"),d=o("PtTable"),u=o("PtRouteViewPopover");return A(),N(V,null,[n(r,{form:i.form,method:b,defaultButtonsShow:"submit,reset",submitAttrs:s.value,inline:"",comps:i.formComps},{buttons:l(()=>[n(p,{permission:"admin:web:dynamicTable:create",route:"/admin/DynamicTableManageAdd"},{default:l(()=>m[1]||(m[1]=[I("添加")])),_:1})]),_:1},8,["form","submitAttrs","comps"]),n(d,{ref_key:"tableRef",ref:c,"default-expand-all":"",dataMethod:x,onDataMethodDataLoading:m[0]||(m[0]=a=>s.value.loading=a),paginationProps:y,columns:i.tableColumns},{defaultAppend:l(()=>[n(t,{label:"操作",width:"180"},{default:l(({row:a,column:g,$index:P})=>[n(f,{options:_({row:a,column:g,$index:P}),dropdownTriggerButtonOptions:{text:!0,buttonText:"更多"}},null,8,["options"])]),_:1})]),_:1},8,["columns"]),n(u,{level:3})],64)}}});export{$ as default};
