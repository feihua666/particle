import{k as T,d as v,r as _,a as w,b as r,o as R,c as D,e as i,w as y,F as U,aw as C,ax as N,ay as B}from"./index-BIT85eDf.js";import{u as I}from"./dataCompItem-B8u6Qt1U.js";import{e as A,d as M}from"./FileTools-Cx4MUywI.js";import"./dynamicTableAdminApi-BJev9B-p.js";import"./dynamicDataCategoryAdminApi-DP_GaZhF.js";import"./dynamicDataIndicatorCategoryAdminApi-CUUVw3kq.js";let P="/admin/web/dynamic_table_upload_record";const k=o=>T.delete(P+"/delete",{data:o}),O=o=>T.get(P+"/page",{params:o}),V=o=>T.put(P+"/publish",o),G=[I({}),{field:{name:"uploadFileName"},element:{comp:"el-input",formItemProps:{label:"上传文件名称"},compProps:{clearable:!0,placeholder:"模糊匹配"}}}],j=v({__name:"DynamicTableUploadRecordManagePage",setup(o){const x=_(null),m=w({form:{},formComps:G,tableColumns:[{prop:"dynamicTableName",label:"动态数据表格名称"},{prop:"uploadFileName",label:"上传文件名称",showOverflowTooltip:!0},{prop:"uploadFileUrl",label:"上传文件地址",showOverflowTooltip:!0},{prop:"uploadTableFieldNum",label:"上传字段数量"},{prop:"uploadTableDataNum",label:"上传数据数量"},{prop:"isPublic",label:"是否发布",formatter:(e,d,a,u)=>a?"已发布":"未发布"}]}),s=_({buttonText:"查询",loading:!1,permission:"admin:web:dynamicTableUploadRecord:pageQuery"}),p=()=>{x.value.refreshData()},h=({pageQuery:e})=>O({...m.form,...e}),g={permission:s.value.permission},F=({row:e,column:d,$index:a})=>a<0?[]:(e.id,[{txt:"下载导入文件",text:!0,permission:"adminDynamicTableDownloadImportFile",method(){let t=C(e.uploadFileUrl),c=e.uploadFileName||N(t);return B(t).then(l=>{let n=l.data,b=A(l),f=decodeURIComponent(c);return M(n,b,f),Promise.resolve(l)})}},{txt:"导入数据管理",text:!0,position:"more",permission:"admin:web:dynamicTable:dataPageQuery",route:{path:"/admin/dynamicTableUploadRecordManageData",query:{id:e.id,dynamicTableId:e.dynamicTableId}}},{txt:"发布数据",text:!0,position:"more",disabled:!!e.isPublic,disabledReason:e.isPublic?"当前数据已发布，不可重复发布":void 0,permission:"admin:web:dynamicTableUploadRecord:publish",methodConfirmText:`确定要发布 ${e.uploadFileName} 吗？发布后对应导入的数据将会同步发布`,method(){return V({id:e.id}).then(t=>(p(),Promise.resolve(t)))}},{txt:"删除",text:!0,position:"more",permission:"admin:web:dynamicTableUploadRecord:delete",methodConfirmText:`确定要删除 ${e.uploadFileName} 吗？删除后已导入的数据不受影响`,method(){return k({id:e.id}).then(t=>(p(),Promise.resolve(t)))}}]);return(e,d)=>{const a=r("PtForm"),u=r("PtButtonGroup"),t=r("el-table-column"),c=r("PtTable"),l=r("PtRouteViewPopover");return R(),D(U,null,[i(a,{form:m.form,method:p,defaultButtonsShow:"submit,reset",submitAttrs:s.value,inline:"",comps:m.formComps},null,8,["form","submitAttrs","comps"]),i(c,{ref_key:"tableRef",ref:x,"default-expand-all":"",dataMethod:h,onDataMethodDataLoading:d[0]||(d[0]=n=>s.value.loading=n),paginationProps:g,columns:m.tableColumns},{defaultAppend:y(()=>[i(t,{label:"操作",width:"220"},{default:y(({row:n,column:b,$index:f})=>[i(u,{options:F({row:n,column:b,$index:f}),dropdownTriggerButtonOptions:{text:!0,buttonText:"更多"}},null,8,["options"])]),_:1})]),_:1},8,["columns"]),i(l,{level:3})],64)}}});export{j as default};
